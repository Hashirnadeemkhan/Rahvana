<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forms Library - Rahvana</title>
<meta name="description" content="Browse all immigration forms organized by journey stage. Find I-130, DS-260, and other USCIS, DOS, and CBP forms.">
<style>
/* ═══════════════════════════════════════════════════════════════════════════
   RAHVANA DESIGN SYSTEM
   ═══════════════════════════════════════════════════════════════════════════ */

:root {
  /* Primary Teal Family */
  --color-primary: #0d7377;
  --color-primary-light: #14a0a6;
  --color-primary-dark: #0a5a5d;
  --color-primary-pale: #e8f6f6;
  --color-secondary: #32e0c4;
  
  /* Neutrals */
  --color-background: #fafbfc;
  --color-surface: #ffffff;
  --color-surface-elevated: #ffffff;
  --color-border: #e1e4e8;
  --color-border-light: #f0f2f4;
  
  /* Text */
  --color-text: #24292e;
  --color-text-secondary: #586069;
  --color-text-muted: #6a737d;
  --color-text-inverse: #ffffff;
  
  /* Semantic */
  --color-success: #28a745;
  --color-success-light: #d4edda;
  --color-warning: #ffc107;
  --color-warning-light: #fff3cd;
  --color-danger: #dc3545;
  --color-info: #17a2b8;
  
  /* Shadows - Premium depth */
  --shadow-xs: 0 1px 2px rgba(0,0,0,0.04);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.04);
  --shadow-lg: 0 10px 20px rgba(0,0,0,0.08), 0 6px 6px rgba(0,0,0,0.04);
  --shadow-xl: 0 20px 40px rgba(0,0,0,0.1), 0 10px 10px rgba(0,0,0,0.04);
  --shadow-glow: 0 0 24px rgba(13,115,119,0.15);
  
  /* Radii */
  --radius-sm: 6px;
  --radius: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-full: 9999px;
  
  /* Typography */
  --font-system: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-display: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  
  /* Spacing Rhythm (4px base) */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 24px;
  --space-8: 32px;
  --space-10: 40px;
  --space-12: 48px;
  --space-16: 64px;
  --space-20: 80px;
  --space-24: 96px;
  
  /* Type Scale */
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;
  --text-3xl: 1.875rem;
  --text-4xl: 2.25rem;
  --text-5xl: 3rem;
  
  /* Line Heights */
  --leading-tight: 1.25;
  --leading-snug: 1.375;
  --leading-normal: 1.5;
  --leading-relaxed: 1.625;
  
  /* Transitions */
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --duration-slow: 400ms;
  
  /* Z-index layers */
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-modal-backdrop: 300;
  --z-modal: 400;
  --z-tooltip: 500;
  
  /* Layout */
  --container-max: 1200px;
  --header-height: 72px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESET & BASE
   ═══════════════════════════════════════════════════════════════════════════ */

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

body {
  font-family: var(--font-system);
  font-size: var(--text-base);
  line-height: var(--leading-normal);
  color: var(--color-text);
  background: var(--color-background);
  overflow-x: hidden;
}

button {
  cursor: pointer;
  background: none;
  border: none;
  font: inherit;
}

a {
  color: inherit;
  text-decoration: none;
}

ul, ol {
  list-style: none;
}

:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

.container {
  width: 100%;
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--space-5);
}

@media (min-width: 768px) {
  .container {
    padding: 0 var(--space-8);
  }
}

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER
   ═══════════════════════════════════════════════════════════════════════════ */

.header {
  position: sticky;
  top: 0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--color-border-light);
  z-index: var(--z-sticky);
  height: var(--header-height);
}

.header-inner {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-6);
}

.logo {
  font-family: var(--font-display);
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--color-primary);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.nav-links {
  display: none;
  gap: var(--space-6);
}

@media (min-width: 768px) {
  .nav-links {
    display: flex;
  }
}

.nav-link {
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--color-text-secondary);
  transition: color var(--duration-fast) var(--ease-out);
}

.nav-link:hover {
  color: var(--color-primary);
}

.nav-link.active {
  color: var(--color-primary);
}

.header-actions {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.queue-badge {
  position: relative;
}

.queue-count {
  position: absolute;
  top: -6px;
  right: -6px;
  background: var(--color-danger);
  color: white;
  font-size: var(--text-xs);
  font-weight: 600;
  min-width: 18px;
  height: 18px;
  border-radius: var(--radius-full);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
}

.btn-icon {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius);
  color: var(--color-text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
}

.btn-icon:hover {
  background: var(--color-primary-pale);
  color: var(--color-primary);
}

.btn-icon svg {
  width: 20px;
  height: 20px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   HERO SECTION
   ═══════════════════════════════════════════════════════════════════════════ */

.hero {
  padding: var(--space-16) 0 var(--space-12);
  background: linear-gradient(135deg, var(--color-primary-pale) 0%, var(--color-surface) 100%);
}

.hero-content {
  max-width: 800px;
  margin: 0 auto;
  text-align: center;
}

.hero-title {
  font-family: var(--font-display);
  font-size: var(--text-4xl);
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: var(--space-4);
  line-height: var(--leading-tight);
}

.hero-subtitle {
  font-size: var(--text-lg);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-8);
}

/* ═══════════════════════════════════════════════════════════════════════════
   SEARCH BAR
   ═══════════════════════════════════════════════════════════════════════════ */

.search-container {
  max-width: 920px;
  margin: 0 auto;
}

.search-bar {
  position: relative;
  margin-bottom: var(--space-6);
}

.search-input {
  width: 100%;
  padding: var(--space-4) var(--space-4) var(--space-4) var(--space-12);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-lg);
  font-size: var(--text-base);
  background: var(--color-surface);
  transition: all var(--duration-fast) var(--ease-out);
  box-shadow: var(--shadow-sm);
}

.search-input:focus {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-md), var(--shadow-glow);
}

.search-icon {
  position: absolute;
  left: var(--space-4);
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-text-muted);
  pointer-events: none;
}

.search-icon svg {
  width: 20px;
  height: 20px;
}

.filter-chips {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  margin-bottom: var(--space-3);
}

.filter-chip {
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-full);
  font-size: var(--text-sm);
  background: var(--color-surface);
  color: var(--color-text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
  white-space: nowrap;
}

.filter-chip:hover {
  border-color: var(--color-primary);
  background: var(--color-primary-pale);
  color: var(--color-primary);
}

.filter-chip.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

.clear-filters {
  padding: var(--space-2) var(--space-4);
  border: none;
  border-radius: var(--radius-full);
  font-size: var(--text-sm);
  background: transparent;
  color: var(--color-primary);
  font-weight: 500;
  transition: all var(--duration-fast) var(--ease-out);
}

.clear-filters:hover {
  background: var(--color-primary-pale);
}

/* ═══════════════════════════════════════════════════════════════════════════
   LIBRARY LAYOUT (AMAZON-STYLE SIDEBAR FILTERS)
   ═══════════════════════════════════════════════════════════════════════════ */

.search-section {
  padding: var(--space-8) 0 var(--space-6);
}

.library-shell {
  padding: var(--space-6) 0 var(--space-16);
}

.library-grid {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: var(--space-10);
  align-items: start;
}

.filters-sidebar {
  position: sticky;
  top: calc(var(--header-height) + var(--space-6));
  align-self: start;
}

.filters-panel {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-6);
}

.filters-title {
  font-size: var(--text-xs);
  font-weight: 800;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--color-text-muted);
  margin-bottom: var(--space-5);
}

.filter-group + .filter-group {
  margin-top: var(--space-6);
  padding-top: var(--space-6);
  border-top: 1px solid var(--color-border-light);
}

.filter-group-title {
  font-size: var(--text-sm);
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: var(--space-3);
}

.filter-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.filters-sidebar .filter-chip {
  width: 100%;
  display: inline-flex;
  justify-content: flex-start;
  gap: var(--space-2);
}

.sidebar-clear {
  width: 100%;
  margin-top: var(--space-6);
  border: 1px dashed var(--color-border);
}

@media (max-width: 980px) {
  .library-grid {
    grid-template-columns: 1fr;
    gap: var(--space-8);
  }

  .filters-sidebar {
    position: relative;
    top: auto;
  }

  .filter-list {
    flex-direction: row;
    flex-wrap: wrap;
  }

  .filters-sidebar .filter-chip {
    width: auto;
  }

  .sidebar-clear {
    width: auto;
  }
}


/* ═══════════════════════════════════════════════════════════════════════════
   JOURNEY SELECTOR
   ═══════════════════════════════════════════════════════════════════════════ */

.journey-section {
  padding: var(--space-12) 0;
}

.journey-selector {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-3);
  margin-bottom: var(--space-10);
  justify-content: center;
}

.journey-pill {
  padding: var(--space-3) var(--space-6);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-full);
  font-size: var(--text-sm);
  font-weight: 600;
  background: var(--color-surface);
  color: var(--color-text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
  white-space: nowrap;
}

.journey-pill:hover {
  border-color: var(--color-primary);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.journey-pill.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
  box-shadow: var(--shadow-glow);
}

/* ═══════════════════════════════════════════════════════════════════════════
   METRO MAP (JOURNEY MAP)
   ═══════════════════════════════════════════════════════════════════════════ */

.metro-map {
  position: relative;
  padding: var(--space-8) 0;
  overflow-x: auto;
  margin-bottom: var(--space-12);
}

.metro-line-container {
  min-width: 900px;
  position: relative;
}

.metro-line {
  position: relative;
  height: 4px;
  background: var(--color-border);
  margin: 60px 0;
  border-radius: var(--radius-full);
}

.metro-stops {
  display: flex;
  justify-content: space-between;
  position: relative;
  padding-top: 14px;
}

.metro-stops::before {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: 26px;
  height: 4px;
  background: var(--color-border);
  border-radius: var(--radius-full);
}

.metro-stop {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  cursor: pointer;
}

.metro-stop-dot {
  width: 24px;
  height: 24px;
  border-radius: var(--radius-full);
  background: var(--color-surface);
  border: 4px solid var(--color-border);
  position: relative;
  z-index: 2;
  transition: all var(--duration-fast) var(--ease-out);
  margin-bottom: var(--space-3);
}

.metro-stop:hover .metro-stop-dot {
  border-color: var(--color-primary);
  transform: scale(1.2);
}

.metro-stop.active .metro-stop-dot {
  border-color: var(--color-primary);
  background: var(--color-primary);
  box-shadow: var(--shadow-glow);
  transform: scale(1.3);
}

.metro-stop-label {
  text-align: center;
  max-width: 140px;
  margin-top: var(--space-3);
}

.metro-stop-name {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-1);
}

.metro-stop-desc {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  line-height: var(--leading-snug);
}

.metro-stop-count {
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-primary);
  background: var(--color-primary-pale);
  padding: 2px var(--space-2);
  border-radius: var(--radius-sm);
  margin-top: var(--space-1);
  white-space: nowrap;
}

@media (max-width: 768px) {
  .metro-map {
    padding: var(--space-6) 0;
  }
  
  .metro-line-container {
    min-width: 600px;
  }
  
  .metro-stop-label {
    max-width: 100px;
  }
  
  .metro-stop-name {
    font-size: var(--text-xs);
  }
  
  .metro-stop-desc {
    display: none;
  }
}

/* ═══════════════════════════════════════════════════════════════════════════
   VIEW TOGGLE
   ═══════════════════════════════════════════════════════════════════════════ */

.view-toggle {
  display: flex;
  width: 100%;
  gap: var(--space-2);
  margin-top: var(--space-3);
  margin-bottom: 0;
}

.toggle-btn {
  flex: 1;
  text-align: center;
  padding: var(--space-3) var(--space-6);
  border: 2px solid var(--color-border);
  border-radius: var(--radius);
  font-size: var(--text-sm);
  font-weight: 600;
  background: var(--color-surface);
  color: var(--color-text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
}

.toggle-btn:hover {
  border-color: var(--color-primary);
  color: var(--color-primary);
}

.toggle-btn.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

/* ═══════════════════════════════════════════════════════════════════════════
   FORMS GRID (DOCUMENT TILES)
   ═══════════════════════════════════════════════════════════════════════════ */

.forms-section {
  padding: 0 0 var(--space-16);
}

.section-header {
  margin-bottom: var(--space-6);
}

.section-title {
  font-size: var(--text-2xl);
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: var(--space-2);
}

.section-count {
  font-size: var(--text-base);
  color: var(--color-text-secondary);
}

.forms-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: var(--space-6);
  margin-bottom: var(--space-8);
}

.form-tile {
  position: relative;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-5);
  transition: all var(--duration-normal) var(--ease-out);
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

/* PDF Document Effect */
.form-tile::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 20px 20px 0;
  border-color: transparent var(--color-border-light) transparent transparent;
  transition: border-color var(--duration-fast) var(--ease-out);
}

.form-tile:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
  border-color: var(--color-primary-light);
}

.form-tile:hover::before {
  border-color: transparent var(--color-primary-pale) transparent transparent;
}

.form-tile-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-4);
  gap: var(--space-3);
}

.form-code {
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--color-primary);
  font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
}

.form-badges {
  display: flex;
  gap: var(--space-2);
  flex-wrap: wrap;
}

.badge {
  padding: 2px var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  white-space: nowrap;
}

.badge-agency {
  background: var(--color-info);
  color: white;
}

.badge-stage {
  background: var(--color-primary-pale);
  color: var(--color-primary-dark);
}

.badge-type {
  background: var(--color-warning-light);
  color: #856404;
}

.form-title {
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-3);
  line-height: var(--leading-snug);
}

.form-preview-lines {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  margin-bottom: var(--space-4);
}

.preview-line {
  height: 4px;
  background: var(--color-border-light);
  border-radius: var(--radius-sm);
}

.preview-line:nth-child(1) { width: 90%; }
.preview-line:nth-child(2) { width: 75%; }
.preview-line:nth-child(3) { width: 85%; }

.form-meta {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
}

.form-actions {
  display: flex;
  gap: var(--space-2);
  opacity: 0;
  transform: translateY(4px);
  transition: all var(--duration-fast) var(--ease-out);
}

.form-tile:hover .form-actions {
  opacity: 1;
  transform: translateY(0);
}

.btn-sm {
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  transition: all var(--duration-fast) var(--ease-out);
}

.btn-primary {
  background: var(--color-primary);
  color: white;
}

.btn-primary:hover {
  background: var(--color-primary-dark);
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--color-surface);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover {
  background: var(--color-primary-pale);
  color: var(--color-primary);
  border-color: var(--color-primary);
}

.empty-state {
  text-align: center;
  padding: var(--space-16) var(--space-4);
}

.empty-icon {
  width: 64px;
  height: 64px;
  margin: 0 auto var(--space-4);
  color: var(--color-text-muted);
  opacity: 0.5;
}

.empty-title {
  font-size: var(--text-xl);
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-2);
}

.empty-text {
  font-size: var(--text-base);
  color: var(--color-text-secondary);
}

/* ═══════════════════════════════════════════════════════════════════════════
   MODAL / DRAWER
   ═══════════════════════════════════════════════════════════════════════════ */

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: var(--z-modal-backdrop);
  opacity: 0;
  visibility: hidden;
  transition: all var(--duration-normal) var(--ease-out);
}

.modal-backdrop.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  position: fixed;
  top: 0;
  right: 0;
  width: 100%;
  max-width: 600px;
  height: 100vh;
  background: var(--color-surface);
  z-index: var(--z-modal);
  transform: translateX(100%);
  transition: transform var(--duration-normal) var(--ease-out);
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
}

.modal.active {
  transform: translateX(0);
}

.modal-header {
  position: sticky;
  top: 0;
  background: var(--color-surface);
  padding: var(--space-6);
  border-bottom: 1px solid var(--color-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1;
}

.modal-title {
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--color-text);
}

.btn-close {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius);
  color: var(--color-text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
}

.btn-close:hover {
  background: var(--color-primary-pale);
  color: var(--color-primary);
}

.btn-close svg {
  width: 20px;
  height: 20px;
}

.modal-content {
  padding: var(--space-6);
}

.detail-section {
  margin-bottom: var(--space-8);
}

.detail-label {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: var(--space-2);
}

.detail-value {
  font-size: var(--text-base);
  color: var(--color-text);
  line-height: var(--leading-relaxed);
}

.detail-value-large {
  font-size: var(--text-2xl);
  font-weight: 700;
  color: var(--color-primary);
  font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

.tag {
  padding: var(--space-1) var(--space-3);
  background: var(--color-primary-pale);
  color: var(--color-primary-dark);
  border-radius: var(--radius-sm);
  font-size: var(--text-sm);
}

.pdf-preview {
  width: 100%;
  height: 600px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
}

.online-callout {
  padding: var(--space-4);
  background: var(--color-info);
  color: white;
  border-radius: var(--radius);
  font-size: var(--text-sm);
  line-height: var(--leading-relaxed);
}

.modal-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  padding: var(--space-6);
  border-top: 1px solid var(--color-border);
  background: var(--color-background);
}

.btn-full {
  width: 100%;
  padding: var(--space-4);
  border-radius: var(--radius);
  font-size: var(--text-base);
  font-weight: 600;
  transition: all var(--duration-fast) var(--ease-out);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
}

.btn-full svg {
  width: 18px;
  height: 18px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FOOTER
   ═══════════════════════════════════════════════════════════════════════════ */

.footer {
  background: var(--color-surface);
  border-top: 1px solid var(--color-border);
  padding: var(--space-8) 0;
  margin-top: var(--space-16);
}

.footer-content {
  text-align: center;
}

.disclaimer {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  line-height: var(--leading-relaxed);
  max-width: 600px;
  margin: 0 auto;
}

/* ═══════════════════════════════════════════════════════════════════════════
   TOAST
   ═══════════════════════════════════════════════════════════════════════════ */

.toast-container {
  position: fixed;
  bottom: var(--space-6);
  right: var(--space-6);
  z-index: calc(var(--z-modal) + 100);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.toast {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  padding: var(--space-4);
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  min-width: 300px;
  opacity: 0;
  transform: translateY(20px);
  transition: all var(--duration-normal) var(--ease-out);
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast-success {
  border-left: 4px solid var(--color-success);
}

.toast-icon {
  width: 20px;
  height: 20px;
  color: var(--color-success);
}

.toast-message {
  flex: 1;
  font-size: var(--text-sm);
  color: var(--color-text);
}

@media (max-width: 640px) {
  .toast-container {
    left: var(--space-4);
    right: var(--space-4);
  }
  
  .toast {
    min-width: 0;
  }
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="container">
    <div class="header-inner">
      <a href="#" class="logo">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        Rahvana
      </a>
      
      <nav class="nav-links">
        <a href="#" class="nav-link">Dashboard</a>
        <a href="#" class="nav-link active">Forms</a>
        <a href="#" class="nav-link">Checklist</a>
        <a href="#" class="nav-link">Resources</a>
      </nav>
      
      <div class="header-actions">
        <button class="btn-icon queue-badge" id="queueBtn" aria-label="AutoFill Queue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          <span class="queue-count" id="queueCount" style="display: none;">0</span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Hero Section -->
<section class="hero">
  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">Immigration Forms Library</h1>
      <p class="hero-subtitle">Browse all forms organized by your journey stage, or search instantly to find exactly what you need.</p>
    </div>
  </div>
</section>

<!-- Search Section -->
<section class="search-section">
  <div class="container">
    <div class="search-container">
      <div class="search-bar">
        <div class="search-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <input 
          type="text" 
          class="search-input" 
          id="searchInput"
          placeholder="Search forms by code, title, or keyword (e.g., I-130, affidavit, work permit)"
          aria-label="Search forms"
        >
      </div>

      <!-- View Toggle -->
      <div class="view-toggle">
      <button class="toggle-btn active" data-view="journey">Journey View</button>
      <button class="toggle-btn" data-view="all">All Forms</button>
    </div>

    </div>
  </div>
</section>

<!-- Forms Library Layout -->
<section class="library-shell">
  <div class="container">
    <div class="library-grid">
      <aside class="filters-sidebar" aria-label="Filters">
        <div class="filters-panel">
          <div class="filters-title">Filters</div>

          <div id="filterChips" class="filters-groups">
            <div class="filter-group">
              <div class="filter-group-title">Agency</div>
              <div class="filter-list">
                <button class="filter-chip" data-filter-type="agency" data-filter-value="USCIS">USCIS</button>
                <button class="filter-chip" data-filter-type="agency" data-filter-value="DOS">DOS/NVC</button>
                <button class="filter-chip" data-filter-type="agency" data-filter-value="CBP">CBP</button>
                <button class="filter-chip" data-filter-type="agency" data-filter-value="SSA">SSA</button>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-group-title">Category</div>
              <div class="filter-list">
                <button class="filter-chip" data-filter-type="category" data-filter-value="Family-based">Family-based</button>
                <button class="filter-chip" data-filter-type="category" data-filter-value="AOS">Adjustment of Status</button>
                <button class="filter-chip" data-filter-type="category" data-filter-value="Financial">Financial/Affidavit</button>
                <button class="filter-chip" data-filter-type="category" data-filter-value="Waiver">Waivers</button>
              </div>
            </div>
          </div>

          <button class="clear-filters sidebar-clear" id="clearFilters">Clear all</button>
        </div>
      </aside>
      <main class="library-main">
        <div class="journey-selector" id="journeySelector">
      <button class="journey-pill active" data-journey="IR1-CR1">IR-1 / CR-1 (Spouse Consular)</button>
      <button class="journey-pill" data-journey="IR5">IR-5 (Parent Consular)</button>
      <button class="journey-pill" data-journey="K1">K-1 (Fiancé)</button>
      <button class="journey-pill" data-journey="AOS">Adjustment of Status</button>
      <button class="journey-pill" data-journey="Naturalization">Naturalization / Post-GC</button>
    </div>

        <!-- Metro Map -->
        <div class="metro-map">
      <div class="metro-line-container">
                <div class="metro-stops" id="metroStops">
          <div class="metro-stop active" data-stage="USCIS Filing">
            <div class="metro-stop-dot"></div>
            <div class="metro-stop-label">
              <div class="metro-stop-name">USCIS Filing</div>
              <div class="metro-stop-desc">Initial petition</div>
              <div class="metro-stop-count">12 forms</div>
            </div>
            
          </div>
          <div class="metro-stop" data-stage="NVC/CEAC">
            <div class="metro-stop-dot"></div>
            <div class="metro-stop-label">
              <div class="metro-stop-name">NVC / CEAC</div>
              <div class="metro-stop-desc">Case processing</div>
              <div class="metro-stop-count">8 forms</div>
            </div>
            
          </div>
          <div class="metro-stop" data-stage="Interview Prep">
            <div class="metro-stop-dot"></div>
            <div class="metro-stop-label">
              <div class="metro-stop-name">Interview Prep</div>
              <div class="metro-stop-desc">Documents & medical</div>
              <div class="metro-stop-count">15 forms</div>
            </div>
            
          </div>
          <div class="metro-stop" data-stage="Port of Entry">
            <div class="metro-stop-dot"></div>
            <div class="metro-stop-label">
              <div class="metro-stop-name">Port of Entry</div>
              <div class="metro-stop-desc">Arrival procedures</div>
              <div class="metro-stop-count">3 forms</div>
            </div>
            
          </div>
          <div class="metro-stop" data-stage="Post-Entry">
            <div class="metro-stop-dot"></div>
            <div class="metro-stop-label">
              <div class="metro-stop-name">Post-Entry</div>
              <div class="metro-stop-desc">SSN, work auth</div>
              <div class="metro-stop-count">6 forms</div>
            </div>
            
          </div>
        </div>
      </div>
    </div>

        <!-- Forms -->
        <div class="section-header">
      <h2 class="section-title" id="sectionTitle">USCIS Filing Stage</h2>
      <p class="section-count" id="sectionCount">Showing 12 forms</p>
    </div>
    
    <div class="forms-grid" id="formsGrid">
      <!-- Forms will be rendered here by JavaScript -->
    </div>
      </main>
    </div>
  </div>
</section>

<!-- Modal Backdrop -->
<div class="modal-backdrop" id="modalBackdrop"></div>

<!-- Form Detail Modal -->
<div class="modal" id="formModal" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
  <div class="modal-header">
    <h2 class="modal-title" id="modalTitle">Form Details</h2>
    <button class="btn-close" id="closeModal" aria-label="Close modal">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
  
  <div class="modal-content" id="modalContent">
    <!-- Content will be populated by JavaScript -->
  </div>
  
  <div class="modal-actions" id="modalActions">
    <!-- Actions will be populated by JavaScript -->
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <p class="disclaimer">
        <strong>Disclaimer:</strong> Rahvana provides educational information and organizational tools. This is not legal advice. For specific guidance on your immigration case, please consult with a licensed immigration attorney.
      </p>
    </div>
  </div>
</footer>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
// ═══════════════════════════════════════════════════════════════════════════
// COMPREHENSIVE FORMS DATABASE
// ═══════════════════════════════════════════════════════════════════════════

const FORMS_DATABASE = [
  // ──────────────── USCIS FAMILY-BASED FORMS ────────────────
  {
    id: 'i130',
    code: 'I-130',
    title: 'Petition for Alien Relative',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'AOS'],
    stage: 'USCIS Filing',
    category: ['Family-based'],
    keywords: ['petition', 'spouse', 'parent', 'child', 'sibling', 'family'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-130.pdf',
    notes: 'Primary petition to establish family relationship for green card eligibility. Required for most family-based immigration.'
  },
  {
    id: 'i130a',
    code: 'I-130A',
    title: 'Supplemental Information for Spouse Beneficiary',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'AOS'],
    stage: 'USCIS Filing',
    category: ['Family-based'],
    keywords: ['spouse', 'biographical', 'supplement'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-130a.pdf',
    notes: 'Required supplement when petitioning for a spouse. Includes biographical information about the beneficiary spouse.'
  },
  {
    id: 'i129f',
    code: 'I-129F',
    title: 'Petition for Alien Fiancé(e)',
    agency: 'USCIS',
    journeys: ['K1'],
    stage: 'USCIS Filing',
    category: ['Family-based'],
    keywords: ['fiancé', 'fiancee', 'k-1', 'k1', 'engagement'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-129f.pdf',
    notes: 'Petition for fiancé(e) visa (K-1). Allows fiancé to enter US to marry within 90 days. Marriage must occur before AOS filing.'
  },
  {
    id: 'i485',
    code: 'I-485',
    title: 'Application to Register Permanent Residence or Adjust Status',
    agency: 'USCIS',
    journeys: ['AOS'],
    stage: 'USCIS Filing',
    category: ['AOS'],
    keywords: ['adjustment', 'status', 'green card', 'aos', 'permanent residence'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-485.pdf',
    notes: 'Main application for adjustment of status to permanent resident. Filed by beneficiaries already in the US seeking green card.'
  },
  {
    id: 'i765',
    code: 'I-765',
    title: 'Application for Employment Authorization',
    agency: 'USCIS',
    journeys: ['AOS', 'K1'],
    stage: 'USCIS Filing',
    category: ['AOS', 'Employment'],
    keywords: ['work permit', 'ead', 'employment', 'authorization', 'work'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-765.pdf',
    notes: 'Application for work authorization (EAD). Can be filed with I-485 for AOS or after K-1 entry and marriage.'
  },
  {
    id: 'i131',
    code: 'I-131',
    title: 'Application for Travel Document',
    agency: 'USCIS',
    journeys: ['AOS'],
    stage: 'USCIS Filing',
    category: ['AOS', 'Travel'],
    keywords: ['advance parole', 'travel', 'reentry', 'ap'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-131.pdf',
    notes: 'Application for advance parole to travel abroad while AOS is pending. Without this, leaving US can abandon AOS application.'
  },
  {
    id: 'i864',
    code: 'I-864',
    title: 'Affidavit of Support Under Section 213A of the INA',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Financial'],
    keywords: ['affidavit', 'support', 'sponsor', 'income', 'financial'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-864.pdf',
    notes: 'Legally binding contract where sponsor agrees to financially support immigrant. Must meet 125% of poverty guidelines.'
  },
  {
    id: 'i864a',
    code: 'I-864A',
    title: 'Contract Between Sponsor and Household Member',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Financial'],
    keywords: ['joint sponsor', 'household member', 'income', 'supplement'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-864a.pdf',
    notes: 'Used when household member combines income with primary sponsor to meet income requirements.'
  },
  {
    id: 'i864ez',
    code: 'I-864EZ',
    title: 'Affidavit of Support Under Section 213A (Simplified)',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'AOS'],
    stage: 'Interview Prep',
    category: ['Financial'],
    keywords: ['affidavit', 'support', 'simplified', 'sponsor', 'income'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-864ez.pdf',
    notes: 'Simplified affidavit of support. Can be used when sponsor meets income requirements solely with current employment.'
  },
  {
    id: 'i864w',
    code: 'I-864W',
    title: 'Intending Immigrant\'s Affidavit of Support Exemption',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'AOS'],
    stage: 'Interview Prep',
    category: ['Financial'],
    keywords: ['exemption', 'work credits', '40 quarters', 'social security'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-864w.pdf',
    notes: 'Exemption from affidavit requirement if immigrant has 40 qualifying work quarters under Social Security Act.'
  },
  {
    id: 'i134',
    code: 'I-134',
    title: 'Declaration of Financial Support',
    agency: 'USCIS',
    journeys: ['K1'],
    stage: 'Interview Prep',
    category: ['Financial'],
    keywords: ['k-1', 'fiancé', 'support', 'financial', 'declaration'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-134.pdf',
    notes: 'Non-binding declaration of financial support for K-1 fiancé visa applicants. Shows ability to support fiancé.'
  },
  {
    id: 'i693',
    code: 'I-693',
    title: 'Report of Medical Examination and Vaccination Record',
    agency: 'USCIS',
    journeys: ['AOS'],
    stage: 'Interview Prep',
    category: ['AOS', 'Medical'],
    keywords: ['medical', 'exam', 'vaccination', 'health', 'civil surgeon'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-693.pdf',
    notes: 'Medical examination by USCIS-approved civil surgeon. Required for AOS applicants. Sealed envelope given to applicant.'
  },
  {
    id: 'i751',
    code: 'I-751',
    title: 'Petition to Remove Conditions on Residence',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'AOS', 'Naturalization'],
    stage: 'Post-Entry',
    category: ['Post-GC'],
    keywords: ['conditional', 'remove conditions', '2-year', 'marriage'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-751.pdf',
    notes: 'Required to remove conditions from 2-year conditional green card (marriages under 2 years). File within 90-day window before expiration.'
  },
  {
    id: 'n400',
    code: 'N-400',
    title: 'Application for Naturalization',
    agency: 'USCIS',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Naturalization'],
    keywords: ['citizenship', 'naturalization', 'citizen', 'oath'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/n-400.pdf',
    notes: 'Application for U.S. citizenship. Can apply 3 years after green card (if married to USC) or 5 years (general).'
  },
  {
    id: 'i90',
    code: 'I-90',
    title: 'Application to Replace Permanent Resident Card',
    agency: 'USCIS',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Post-GC'],
    keywords: ['replace', 'renew', 'green card', 'lost', 'stolen', 'damaged'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-90.pdf',
    notes: 'Replace or renew permanent resident card. File if card is lost, stolen, damaged, expired, or has incorrect information.'
  },
  {
    id: 'ar11',
    code: 'AR-11',
    title: 'Alien\'s Change of Address Card',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS', 'Naturalization'],
    stage: 'Post-Entry',
    category: ['Administrative'],
    keywords: ['address', 'change', 'move', 'relocation'],
    type: 'online',
    pdfUrl: '',
    notes: 'All non-citizens must notify USCIS within 10 days of changing address. Can be filed online at uscis.gov.'
  },
  {
    id: 'i102',
    code: 'I-102',
    title: 'Application for Replacement/Initial Nonimmigrant Arrival-Departure Document',
    agency: 'USCIS',
    journeys: ['AOS'],
    stage: 'Post-Entry',
    category: ['Administrative'],
    keywords: ['i-94', 'arrival', 'departure', 'lost', 'replace'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-102.pdf',
    notes: 'Replace lost or never-received I-94 arrival/departure record. Required for various immigration processes.'
  },
  {
    id: 'i407',
    code: 'I-407',
    title: 'Record of Abandonment of Lawful Permanent Resident Status',
    agency: 'USCIS',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Post-GC'],
    keywords: ['abandon', 'green card', 'surrender', 'give up'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-407.pdf',
    notes: 'Voluntary abandonment of permanent resident status. Used when permanently moving outside US.'
  },
  
  // ──────────────── USCIS WAIVER FORMS ────────────────
  {
    id: 'i601',
    code: 'I-601',
    title: 'Application for Waiver of Grounds of Inadmissibility',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Waiver'],
    keywords: ['waiver', 'inadmissibility', 'unlawful presence', 'extreme hardship'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-601.pdf',
    notes: 'Waiver for inadmissibility due to unlawful presence, fraud, criminal history, etc. Requires proof of extreme hardship to USC/LPR relative.'
  },
  {
    id: 'i601a',
    code: 'I-601A',
    title: 'Provisional Unlawful Presence Waiver',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'Interview Prep',
    category: ['Waiver'],
    keywords: ['provisional', 'waiver', 'unlawful presence', '3/10 year bar'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-601a.pdf',
    notes: 'Provisional waiver for unlawful presence before consular interview. Allows applicant to wait for approval in US.'
  },
  {
    id: 'i212',
    code: 'I-212',
    title: 'Application for Permission to Reapply for Admission',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'AOS'],
    stage: 'Interview Prep',
    category: ['Waiver'],
    keywords: ['reentry', 'deportation', 'removal', 'previous removal'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-212.pdf',
    notes: 'Permission to reapply after deportation or removal. Required if previously removed or deported from US.'
  },
  
  // ──────────────── DOS / NVC / CEAC FORMS ────────────────
  {
    id: 'ds260',
    code: 'DS-260',
    title: 'Immigrant Visa and Alien Registration Application',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'NVC/CEAC',
    category: ['Consular'],
    keywords: ['immigrant visa', 'application', 'consular', 'online'],
    type: 'online',
    pdfUrl: '',
    notes: 'Main immigrant visa application completed online at CEAC. Required for all consular processing cases. Cannot be downloaded as PDF.'
  },
  {
    id: 'ds261',
    code: 'DS-261',
    title: 'Choice of Address and Agent',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'NVC/CEAC',
    category: ['Consular'],
    keywords: ['nvc', 'address', 'agent', 'choice'],
    type: 'online',
    pdfUrl: '',
    notes: 'Form to provide address and agent information to NVC. Completed online through CEAC portal.'
  },
  {
    id: 'ds160',
    code: 'DS-160',
    title: 'Nonimmigrant Visa Application',
    agency: 'DOS',
    journeys: ['K1'],
    stage: 'NVC/CEAC',
    category: ['Consular'],
    keywords: ['k-1', 'nonimmigrant', 'visa application', 'fiancé'],
    type: 'online',
    pdfUrl: '',
    notes: 'Nonimmigrant visa application for K-1 fiancé visa applicants. Completed online at CEAC.'
  },
  {
    id: 'ds5535',
    code: 'DS-5535',
    title: 'Supplemental Questions for Visa Applicants',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5', 'K1'],
    stage: 'Interview Prep',
    category: ['Consular'],
    keywords: ['supplemental', 'additional questions', 'security check', 'administrative processing'],
    type: 'pdf',
    pdfUrl: 'https://eforms.state.gov/Forms/ds5535.pdf',
    notes: 'Additional questionnaire sometimes requested during administrative processing. Covers detailed travel, employment, and social media history.'
  },
  {
    id: 'ds5540',
    code: 'DS-5540',
    title: 'Affidavit of Support Sponsor\'s Financial Information',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5', 'K1'],
    stage: 'Interview Prep',
    category: ['Financial', 'Consular'],
    keywords: ['financial', 'sponsor', 'income verification'],
    type: 'pdf',
    pdfUrl: 'https://eforms.state.gov/Forms/ds5540.pdf',
    notes: 'Supplemental financial information form sometimes requested at consular interviews to verify sponsor income.'
  },
  {
    id: 'ds230',
    code: 'DS-230',
    title: 'Application for Immigrant Visa and Alien Registration',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'Interview Prep',
    category: ['Consular'],
    keywords: ['immigrant visa', 'paper application', 'legacy'],
    type: 'pdf',
    pdfUrl: 'https://eforms.state.gov/Forms/ds230.pdf',
    notes: 'Legacy paper form (replaced by DS-260). Rarely used now but may be needed in special circumstances.'
  },
  {
    id: 'ds2001',
    code: 'DS-2001',
    title: 'Notification of Immigrant Visa Applicant',
    agency: 'DOS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'Interview Prep',
    category: ['Consular'],
    keywords: ['notification', 'instructions', 'interview'],
    type: 'pdf',
    pdfUrl: 'https://travel.state.gov/content/dam/visas/DS-2001%20--%20Notification%20of%20Applicant%20Ready%20(10-2019).pdf',
    notes: 'Instructions sent by consular section when case is ready for interview scheduling.'
  },
  {
    id: 'ds156',
    code: 'DS-156',
    title: 'Nonimmigrant Visa Application (Legacy)',
    agency: 'DOS',
    journeys: ['K1'],
    stage: 'Interview Prep',
    category: ['Consular'],
    keywords: ['legacy', 'nonimmigrant', 'old form'],
    type: 'pdf',
    pdfUrl: '',
    notes: 'Legacy form replaced by DS-160. Included here for reference only. No longer in use.'
  },
  
  // ──────────────── CBP FORMS ────────────────
  {
    id: 'i94',
    code: 'I-94',
    title: 'Arrival/Departure Record',
    agency: 'CBP',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Port of Entry',
    category: ['Travel', 'Administrative'],
    keywords: ['arrival', 'departure', 'entry', 'border', 'admission'],
    type: 'online',
    pdfUrl: '',
    notes: 'Electronic arrival/departure record. Created automatically at port of entry. Can retrieve online at i94.cbp.dhs.gov.'
  },
  {
    id: 'cbp6059b',
    code: 'CBP Form 6059B',
    title: 'Customs Declaration',
    agency: 'CBP',
    journeys: ['IR1-CR1', 'IR5', 'K1'],
    stage: 'Port of Entry',
    category: ['Travel'],
    keywords: ['customs', 'declaration', 'arrival', 'goods'],
    type: 'pdf',
    pdfUrl: 'https://www.cbp.gov/sites/default/files/assets/documents/2019-Mar/CBP%20Form%206059B%20-%20English%20%2803-2019%29_3.pdf',
    notes: 'Customs declaration form completed when entering US. Declares goods being brought into country.'
  },
  {
    id: 'i551',
    code: 'I-551',
    title: 'Permanent Resident Card (Green Card)',
    agency: 'CBP',
    journeys: ['IR1-CR1', 'IR5', 'AOS'],
    stage: 'Post-Entry',
    category: ['Post-GC'],
    keywords: ['green card', 'permanent resident', 'card'],
    type: 'action',
    pdfUrl: '',
    notes: 'The actual green card issued after immigrant visa or AOS approval. Not a fillable form but important document.'
  },
  
  // ──────────────── SSA FORMS ────────────────
  {
    id: 'ss5',
    code: 'SS-5',
    title: 'Application for a Social Security Card',
    agency: 'SSA',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Post-Entry',
    category: ['Post-Entry'],
    keywords: ['social security', 'ssn', 'card', 'number'],
    type: 'pdf',
    pdfUrl: 'https://www.ssa.gov/forms/ss-5.pdf',
    notes: 'Application for Social Security Number. Should be applied for soon after entry or when receiving work authorization.'
  },
  {
    id: 'ssa7050',
    code: 'SSA-7050-F4',
    title: 'Request for Social Security Earnings Information',
    agency: 'SSA',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Naturalization', 'Financial'],
    keywords: ['earnings', 'work history', 'quarters', 'ssa'],
    type: 'pdf',
    pdfUrl: 'https://www.ssa.gov/forms/ssa-7050.pdf',
    notes: 'Request detailed earnings history from Social Security Administration. May be needed for I-864W or other purposes.'
  },
  
  // ──────────────── CIVIL DOCUMENTS TEMPLATES ────────────────
  {
    id: 'birth-cert',
    code: 'Birth Certificate',
    title: 'Birth Certificate (Civil Document)',
    agency: 'Civil Authority',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['birth', 'certificate', 'civil document', 'vital record'],
    type: 'template',
    pdfUrl: '',
    notes: 'Original or certified copy of birth certificate required. Must be translated if not in English. Obtain from vital records office.'
  },
  {
    id: 'marriage-cert',
    code: 'Marriage Certificate',
    title: 'Marriage Certificate (Civil Document)',
    agency: 'Civil Authority',
    journeys: ['IR1-CR1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['marriage', 'certificate', 'civil document', 'vital record'],
    type: 'template',
    pdfUrl: '',
    notes: 'Official marriage certificate required for spousal petitions. Must be certified copy. Translation required if not in English.'
  },
  {
    id: 'divorce-decree',
    code: 'Divorce Decree',
    title: 'Divorce Decree/Certificate (Civil Document)',
    agency: 'Civil Authority',
    journeys: ['IR1-CR1', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['divorce', 'decree', 'certificate', 'dissolution', 'termination'],
    type: 'template',
    pdfUrl: '',
    notes: 'Required if either party was previously married. Must show legal termination of prior marriage(s). Translation if not in English.'
  },
  {
    id: 'police-cert',
    code: 'Police Certificate',
    title: 'Police Certificate (Civil Document)',
    agency: 'Foreign Police/Government',
    journeys: ['IR1-CR1', 'IR5', 'K1'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['police', 'certificate', 'clearance', 'criminal', 'background'],
    type: 'template',
    pdfUrl: '',
    notes: 'Required from each country whereapplicant lived for 6+ months since age 16. Shows no criminal record or lists any arrests/convictions.'
  },
  {
    id: 'passport-copy',
    code: 'Passport Copy',
    title: 'Passport Copy (Civil Document)',
    agency: 'Foreign Government',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['passport', 'identity', 'travel document'],
    type: 'template',
    pdfUrl: '',
    notes: 'Valid passport required for international travel and visa processing. Must be valid for at least 6 months beyond intended entry date.'
  },
  {
    id: 'military-records',
    code: 'Military Records',
    title: 'Military Service Records (Civil Document)',
    agency: 'Military Authority',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'Interview Prep',
    category: ['Civil Documents'],
    keywords: ['military', 'service', 'discharge', 'records'],
    type: 'template',
    pdfUrl: '',
    notes: 'Required if applicant served in any country\'s military. Must include dates of service and discharge status.'
  },
  
  // ──────────────── ADDITIONAL USCIS FORMS ────────────────
  {
    id: 'i912',
    code: 'I-912',
    title: 'Request for Fee Waiver',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS', 'Naturalization'],
    stage: 'USCIS Filing',
    category: ['Financial'],
    keywords: ['fee waiver', 'poverty', 'financial hardship', 'waive fee'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-912.pdf',
    notes: 'Request to waive filing fees based on financial hardship. Must demonstrate income at or below 150% of Federal Poverty Guidelines.'
  },
  {
    id: 'g1145',
    code: 'G-1145',
    title: 'E-Notification of Application/Petition Acceptance',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS', 'Naturalization'],
    stage: 'USCIS Filing',
    category: ['Administrative'],
    keywords: ['notification', 'email', 'text', 'receipt'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/g-1145.pdf',
    notes: 'Optional form to receive email/text notification when USCIS accepts your application. Attach on top of application packet.'
  },
  {
    id: 'g28',
    code: 'G-28',
    title: 'Notice of Entry of Appearance as Attorney or Accredited Representative',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS', 'Naturalization'],
    stage: 'USCIS Filing',
    category: ['Administrative'],
    keywords: ['attorney', 'lawyer', 'representative', 'appearance'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/g-28.pdf',
    notes: 'Filed by attorney or accredited representative to formally represent applicant before USCIS.'
  },
  {
    id: 'i824',
    code: 'I-824',
    title: 'Application for Action on an Approved Application or Petition',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS'],
    stage: 'NVC/CEAC',
    category: ['Administrative'],
    keywords: ['duplicate', 'notification', 'consulate', 'action'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-824.pdf',
    notes: 'Request USCIS to notify consulate, send duplicate approval notice, or take other action on approved petition.'
  },
  {
    id: 'i290b',
    code: 'I-290B',
    title: 'Notice of Appeal or Motion',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5', 'K1', 'AOS', 'Naturalization'],
    stage: 'USCIS Filing',
    category: ['Administrative'],
    keywords: ['appeal', 'motion', 'denial', 'reconsider'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-290b.pdf',
    notes: 'Appeal an unfavorable USCIS decision or file a motion to reopen or reconsider. Must be filed within 30-33 days of decision.'
  },
  {
    id: 'i539',
    code: 'I-539',
    title: 'Application to Extend/Change Nonimmigrant Status',
    agency: 'USCIS',
    journeys: ['K1', 'AOS'],
    stage: 'USCIS Filing',
    category: ['Status'],
    keywords: ['extend', 'change status', 'visitor', 'tourist', 'b2'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-539.pdf',
    notes: 'Extend or change nonimmigrant status. Used by visitors, students, or other nonimmigrants seeking to extend stay or change category.'
  },
  {
    id: 'i730',
    code: 'I-730',
    title: 'Refugee/Asylee Relative Petition',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'USCIS Filing',
    category: ['Family-based'],
    keywords: ['refugee', 'asylee', 'derivative', 'family'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-730.pdf',
    notes: 'Petition for qualifying family members of refugees or asylees. Must be filed within 2 years of grant of refugee/asylee status.'
  },
  {
    id: 'i360',
    code: 'I-360',
    title: 'Petition for Amerasian, Widow(er), or Special Immigrant',
    agency: 'USCIS',
    journeys: ['IR1-CR1', 'IR5'],
    stage: 'USCIS Filing',
    category: ['Family-based'],
    keywords: ['widow', 'widower', 'special immigrant', 'vawa'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-360.pdf',
    notes: 'Self-petition for special immigrant categories including VAWA self-petitioners, widows/widowers of USC, and others.'
  },
  {
    id: 'n565',
    code: 'N-565',
    title: 'Application for Replacement Naturalization/Citizenship Document',
    agency: 'USCIS',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Naturalization'],
    keywords: ['replace', 'citizenship', 'certificate', 'naturalization', 'lost'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/n-565.pdf',
    notes: 'Replace lost, stolen, or damaged Certificate of Naturalization or Certificate of Citizenship.'
  },
  {
    id: 'n600',
    code: 'N-600',
    title: 'Application for Certificate of Citizenship',
    agency: 'USCIS',
    journeys: ['Naturalization'],
    stage: 'Post-Entry',
    category: ['Naturalization'],
    keywords: ['citizenship', 'certificate', 'derivative', 'automatic'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/n-600.pdf',
    notes: 'Apply for Certificate of Citizenship if you acquired or derived U.S. citizenship through parents.'
  },
  {
    id: 'i140',
    code: 'I-140',
    title: 'Immigrant Petition for Alien Worker',
    agency: 'USCIS',
    journeys: [],
    stage: 'USCIS Filing',
    category: ['Employment'],
    keywords: ['employment', 'work', 'eb', 'labor'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-140.pdf',
    notes: 'Employment-based immigrant petition. Filed by employer for foreign worker seeking employment-based green card (EB-1, EB-2, EB-3, etc.).'
  },
  {
    id: 'i526',
    code: 'I-526',
    title: 'Immigrant Petition by Alien Investor',
    agency: 'USCIS',
    journeys: [],
    stage: 'USCIS Filing',
    category: ['Employment'],
    keywords: ['investor', 'eb-5', 'investment', 'entrepreneur'],
    type: 'pdf',
    pdfUrl: 'https://www.uscis.gov/sites/default/files/document/forms/i-526.pdf',
    notes: 'Petition for EB-5 immigrant investor program. Requires substantial investment in U.S. commercial enterprise creating jobs.'
  }
];

// ═══════════════════════════════════════════════════════════════════════════
// STATE MANAGEMENT
// ═══════════════════════════════════════════════════════════════════════════

let currentView = 'journey';
let currentJourney = 'IR1-CR1';
let currentStage = 'USCIS Filing';
let searchQuery = '';
let activeFilters = {
  agency: [],
  category: []
};
let autofillQueue = [];

// ═══════════════════════════════════════════════════════════════════════════
// HELPER FUNCTIONS
// ═══════════════════════════════════════════════════════════════════════════

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ═══════════════════════════════════════════════════════════════════════════
// FILTERING & SEARCHING
// ═══════════════════════════════════════════════════════════════════════════

function getFilteredForms() {
  let forms = FORMS_DATABASE;
  
  // Filter by journey (if in journey view)
  if (currentView === 'journey') {
    forms = forms.filter(form => form.journeys.includes(currentJourney));
    
    // Filter by stage
    forms = forms.filter(form => form.stage === currentStage);
  }
  
  // Apply search query
  if (searchQuery) {
    const query = searchQuery.toLowerCase();
    forms = forms.filter(form => {
      return form.code.toLowerCase().includes(query) ||
             form.title.toLowerCase().includes(query) ||
             form.agency.toLowerCase().includes(query) ||
             form.keywords.some(kw => kw.toLowerCase().includes(query)) ||
             form.notes.toLowerCase().includes(query);
    });
  }
  
  // Apply agency filters
  if (activeFilters.agency.length > 0) {
    forms = forms.filter(form => activeFilters.agency.includes(form.agency));
  }
  
  // Apply category filters
  if (activeFilters.category.length > 0) {
    forms = forms.filter(form => 
      form.category.some(cat => activeFilters.category.includes(cat))
    );
  }
  
  return forms;
}

function updateStageCounts() {
  const stops = document.querySelectorAll('.metro-stop');
  
  stops.forEach(stop => {
    const stage = stop.dataset.stage;
    const count = FORMS_DATABASE.filter(form => 
      form.journeys.includes(currentJourney) && form.stage === stage
    ).length;
    
    const countEl = stop.querySelector('.metro-stop-count');
    if (countEl) {
      countEl.textContent = `${count} form${count !== 1 ? 's' : ''}`;
    }
  });
}

// ═══════════════════════════════════════════════════════════════════════════
// RENDERING
// ═══════════════════════════════════════════════════════════════════════════

function renderForms() {
  const grid = document.getElementById('formsGrid');
  const forms = getFilteredForms();
  
  // Update section header
  const sectionTitle = document.getElementById('sectionTitle');
  const sectionCount = document.getElementById('sectionCount');
  
  if (currentView === 'journey') {
    sectionTitle.textContent = `${currentStage} Stage`;
  } else {
    sectionTitle.textContent = 'All Forms';
  }
  
  sectionCount.textContent = `Showing ${forms.length} form${forms.length !== 1 ? 's' : ''}`;
  
  // Render forms
  if (forms.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="12" y1="18" x2="12" y2="12"></line>
          <line x1="9" y1="15" x2="15" y2="15"></line>
        </svg>
        <h3 class="empty-title">No forms found</h3>
        <p class="empty-text">Try adjusting your search or filters</p>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = forms.map(form => `
    <div class="form-tile" data-form-id="${form.id}" tabindex="0" role="button" aria-label="View details for ${escapeHtml(form.code)}">
      <div class="form-tile-header">
        <div class="form-code">${escapeHtml(form.code)}</div>
        <div class="form-badges">
          <span class="badge badge-agency">${escapeHtml(form.agency)}</span>
          ${form.type !== 'pdf' ? `<span class="badge badge-type">${escapeHtml(form.type)}</span>` : ''}
        </div>
      </div>
      <h3 class="form-title">${escapeHtml(form.title)}</h3>
      <div class="form-preview-lines">
        <div class="preview-line"></div>
        <div class="preview-line"></div>
        <div class="preview-line"></div>
      </div>
      <div class="form-meta">${escapeHtml(form.stage)}</div>
      <div class="form-actions">
        <button class="btn-sm btn-primary" onclick="event.stopPropagation(); openFormDetail('${form.id}')" aria-label="View details">
          Preview
        </button>
        <button class="btn-sm btn-secondary" onclick="event.stopPropagation(); addToQueue('${form.id}')" aria-label="Add to queue">
          Add to Queue
        </button>
      </div>
    </div>
  `).join('');
  
  // Add click handlers
  document.querySelectorAll('.form-tile').forEach(tile => {
    tile.addEventListener('click', () => {
      openFormDetail(tile.dataset.formId);
    });
    
    tile.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openFormDetail(tile.dataset.formId);
      }
    });
  });
}

function openFormDetail(formId) {
  const form = FORMS_DATABASE.find(f => f.id === formId);
  if (!form) return;
  
  const modalContent = document.getElementById('modalContent');
  const modalActions = document.getElementById('modalActions');
  
  // Build content
  let contentHTML = `
    <div class="detail-section">
      <div class="detail-label">Form Code</div>
      <div class="detail-value-large">${escapeHtml(form.code)}</div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Full Title</div>
      <div class="detail-value">${escapeHtml(form.title)}</div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Agency</div>
      <div class="detail-value">${escapeHtml(form.agency)}</div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Journey Stage</div>
      <div class="detail-value">${escapeHtml(form.stage)}</div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Categories</div>
      <div class="tags">
        ${form.category.map(cat => `<span class="tag">${escapeHtml(cat)}</span>`).join('')}
      </div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Keywords</div>
      <div class="tags">
        ${form.keywords.map(kw => `<span class="tag">${escapeHtml(kw)}</span>`).join('')}
      </div>
    </div>
    
    <div class="detail-section">
      <div class="detail-label">Notes</div>
      <div class="detail-value">${escapeHtml(form.notes)}</div>
    </div>
  `;
  
  // Add type-specific content
  if (form.type === 'online') {
    contentHTML += `
      <div class="detail-section">
        <div class="online-callout">
          <strong>Online Form:</strong> This form must be completed online and cannot be downloaded as a PDF. Visit the official government website to access and submit this form.
        </div>
      </div>
    `;
  } else if (form.type === 'pdf' && form.pdfUrl) {
    contentHTML += `
      <div class="detail-section">
        <div class="detail-label">PDF Preview</div>
        <iframe class="pdf-preview" src="${escapeHtml(form.pdfUrl)}" title="PDF preview of ${escapeHtml(form.code)}"></iframe>
      </div>
    `;
  } else if (form.type === 'template') {
    contentHTML += `
      <div class="detail-section">
        <div class="online-callout" style="background: var(--color-warning); color: var(--color-text);">
          <strong>Civil Document:</strong> This is not a government form but a required supporting document. Obtain from the appropriate civil authority in your country.
        </div>
      </div>
    `;
  }
  
  modalContent.innerHTML = contentHTML;
  
  // Build actions
  let actionsHTML = `
    <button class="btn-full btn-primary" onclick="addToQueue('${form.id}')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 5v14M5 12h14"/>
      </svg>
      Add to AutoFill Queue
    </button>
  `;
  
  if (form.type === 'pdf' && form.pdfUrl) {
    actionsHTML += `
      <button class="btn-full btn-secondary" onclick="window.open('${escapeHtml(form.pdfUrl)}', '_blank')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Download PDF
      </button>
    `;
  }
  
  actionsHTML += `
    <button class="btn-full btn-secondary" onclick="copyFormCode('${escapeHtml(form.code)}')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
      Copy Form Code
    </button>
  `;
  
  modalActions.innerHTML = actionsHTML;
  
  // Open modal
  document.getElementById('modalBackdrop').classList.add('active');
  document.getElementById('formModal').classList.add('active');
  document.body.style.overflow = 'hidden';
  
  // Focus trap
  document.getElementById('closeModal').focus();
}

function closeModal() {
  document.getElementById('modalBackdrop').classList.remove('active');
  document.getElementById('formModal').classList.remove('active');
  document.body.style.overflow = '';
}

// ═══════════════════════════════════════════════════════════════════════════
// QUEUE MANAGEMENT
// ═══════════════════════════════════════════════════════════════════════════

function addToQueue(formId) {
  const form = FORMS_DATABASE.find(f => f.id === formId);
  if (!form) return;
  
  if (!autofillQueue.includes(formId)) {
    autofillQueue.push(formId);
    updateQueueCount();
    showToast(`${form.code} added to queue`, 'success');
  } else {
    showToast(`${form.code} is already in queue`, 'info');
  }
}

function updateQueueCount() {
  const badge = document.getElementById('queueCount');
  if (autofillQueue.length > 0) {
    badge.textContent = autofillQueue.length;
    badge.style.display = 'flex';
  } else {
    badge.style.display = 'none';
  }
}

function copyFormCode(code) {
  navigator.clipboard.writeText(code).then(() => {
    showToast(`${code} copied to clipboard`, 'success');
  });
}

// ═══════════════════════════════════════════════════════════════════════════
// TOAST NOTIFICATIONS
// ═══════════════════════════════════════════════════════════════════════════

function showToast(message, type = 'success') {
  const container = document.getElementById('toastContainer');
  
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.innerHTML = `
    <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span class="toast-message">${escapeHtml(message)}</span>
  `;
  
  container.appendChild(toast);
  
  requestAnimationFrame(() => {
    toast.classList.add('show');
  });
  
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// ═══════════════════════════════════════════════════════════════════════════
// EVENT HANDLERS
// ═══════════════════════════════════════════════════════════════════════════

// Search
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', debounce((e) => {
  searchQuery = e.target.value;
  renderForms();
}, 200));

// Journey selector
document.querySelectorAll('.journey-pill').forEach(pill => {
  pill.addEventListener('click', () => {
    document.querySelectorAll('.journey-pill').forEach(p => p.classList.remove('active'));
    pill.classList.add('active');
    currentJourney = pill.dataset.journey;
    currentStage = 'USCIS Filing'; // Reset to first stage
    
    // Update metro stops
    document.querySelectorAll('.metro-stop').forEach(s => s.classList.remove('active'));
    document.querySelector('.metro-stop[data-stage="USCIS Filing"]').classList.add('active');
    
    updateStageCounts();
    renderForms();
  });
});

// Metro stops
document.querySelectorAll('.metro-stop').forEach(stop => {
  stop.addEventListener('click', () => {
    document.querySelectorAll('.metro-stop').forEach(s => s.classList.remove('active'));
    stop.classList.add('active');
    currentStage = stop.dataset.stage;
    renderForms();
  });
});

// View toggle
document.querySelectorAll('.toggle-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentView = btn.dataset.view;
    renderForms();
  });
});

// Filter chips
document.querySelectorAll('.filter-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    const filterType = chip.dataset.filterType;
    const filterValue = chip.dataset.filterValue;
    
    chip.classList.toggle('active');
    
    if (chip.classList.contains('active')) {
      activeFilters[filterType].push(filterValue);
    } else {
      activeFilters[filterType] = activeFilters[filterType].filter(v => v !== filterValue);
    }
    
    renderForms();
  });
});

// Clear filters
document.getElementById('clearFilters').addEventListener('click', () => {
  document.querySelectorAll('.filter-chip').forEach(chip => chip.classList.remove('active'));
  activeFilters = { agency: [], category: [] };
  searchQuery = '';
  searchInput.value = '';
  renderForms();
});

// Modal close
document.getElementById('closeModal').addEventListener('click', closeModal);
document.getElementById('modalBackdrop').addEventListener('click', closeModal);

// Keyboard navigation
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
  }
});

// Prevent modal close when clicking inside modal
document.getElementById('formModal').addEventListener('click', (e) => {
  e.stopPropagation();
});

// ═══════════════════════════════════════════════════════════════════════════
// INITIALIZATION
// ═══════════════════════════════════════════════════════════════════════════

document.addEventListener('DOMContentLoaded', () => {
  updateStageCounts();
  renderForms();
  updateQueueCount();
});

</script>
</body>
</html>