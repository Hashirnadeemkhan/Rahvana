<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rahvana - Your IR-1 Visa Journey Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0d9488;
            --primary-dark: #0f766e;
            --primary-light: #5eead4;
            --secondary: #475569;
            --secondary-dark: #334155;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 12px 30px rgba(0,0,0,0.12);
            --radius: 12px;
            --radius-sm: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            font-size: 15px;
            transition: color 0.2s;
        }

        .nav a:hover {
            color: var(--primary);
        }

        .auth-toggle {
            padding: 8px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .auth-toggle:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        /* Section Container */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 60px 24px;
        }

        .container-narrow {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 24px;
        }

        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: var(--bg);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover {
            background: #d97706;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 16px;
        }

        /* Landing Page */
        .hero {
            background: linear-gradient(135deg, rgba(13,148,136,0.08) 0%, rgba(245,158,11,0.08) 100%);
            padding: 80px 24px;
            text-align: center;
            border-radius: var(--radius);
            margin-bottom: 60px;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--text);
            line-height: 1.2;
        }

        .hero p {
            font-size: 20px;
            color: var(--text-light);
            margin-bottom: 32px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-ctas {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
        }

        .badge-free {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-premium {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-stage {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--text);
        }

        .card p {
            color: var(--text-light);
            margin-bottom: 16px;
        }

        .grid {
            display: grid;
            gap: 24px;
            margin-bottom: 40px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        /* Journey Cards */
        .journey-card {
            position: relative;
        }

        .journey-status {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 12px;
            background: var(--success);
            color: white;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }

        .journey-status.coming-soon {
            background: var(--text-muted);
        }

        .tool-card-tags {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        /* Video Placeholder */
        .video-placeholder {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            border-radius: var(--radius);
            padding: 40px 24px;
            color: white;
            margin: 24px 0;
        }

        .video-placeholder h4 {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .video-placeholder ul {
            list-style: none;
            margin: 12px 0;
        }

        .video-placeholder li {
            margin-bottom: 6px;
            padding-left: 20px;
            position: relative;
        }

        .video-placeholder li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .video-play-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            cursor: not-allowed;
            margin-top: 16px;
            display: inline-block;
        }

        /* Pricing */
        .pricing-toggle {
            text-align: center;
            margin-bottom: 40px;
        }

        .pricing-toggle button {
            padding: 10px 24px;
            margin: 0 4px;
            border: 1px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            font-weight: 500;
        }

        .pricing-toggle button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pricing-card {
            text-align: center;
            position: relative;
        }

        .pricing-card.featured {
            border: 2px solid var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .pricing-card .price {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin: 16px 0;
        }

        .pricing-card .price-period {
            font-size: 16px;
            color: var(--text-light);
        }

        .pricing-card ul {
            list-style: none;
            text-align: left;
            margin: 24px 0;
        }

        .pricing-card li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pricing-card li:before {
            content: "‚úì";
            color: var(--success);
            font-weight: 700;
        }

        /* Footer */
        .footer {
            background: var(--secondary-dark);
            color: white;
            padding: 40px 24px;
            margin-top: 80px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .disclaimer {
            background: rgba(245,158,11,0.1);
            border-left: 4px solid var(--accent);
            padding: 16px;
            margin-bottom: 24px;
            border-radius: var(--radius-sm);
        }

        .disclaimer p {
            font-size: 14px;
            line-height: 1.5;
        }

        .footer-links {
            display: flex;
            gap: 24px;
            justify-content: center;
            margin-top: 24px;
        }

        .footer-links a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 14px;
        }

        .footer-links a:hover {
            color: white;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }

        .progress-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
        }

        .progress-bar {
            height: 12px;
            background: var(--border);
            border-radius: 999px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
            transition: width 0.3s;
        }

        /* Wizard Styles (from original file) */
        .wizard-container {
            display: flex;
            gap: 24px;
            min-height: 80vh;
        }

        .sidebar {
            width: 280px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            position: sticky;
            top: 90px;
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .sidebar-logo {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 24px;
        }

        .progress-summary {
            background: var(--bg);
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
        }

        .stage-nav {
            list-style: none;
        }

        .stage-item {
            margin-bottom: 10px;
        }

        .stage-btn {
            width: 100%;
            text-align: left;
            padding: 12px;
            background: none;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stage-btn:hover {
            background: var(--bg);
            border-color: var(--primary);
        }

        .stage-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .wizard-main {
            flex: 1;
            min-width: 0;
        }

        .wizard-header {
            margin-bottom: 30px;
        }

        .wizard-header h2 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .wizard-header p {
            color: var(--text-light);
            font-size: 16px;
        }

        .controls {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
        }

        .toggle-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .toggle-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--surface);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            border-color: var(--primary);
        }

        .toggle-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .stage-layout {
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }

        .tree-panel {
            width: 280px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 16px;
            position: sticky;
            top: 90px;
            max-height: calc(100vh - 120px);
            overflow: auto;
        }

        .tree-title {
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 16px;
        }

        .tree-subtitle {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 16px;
        }

        .tree-item {
            width: 100%;
            text-align: left;
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 10px;
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            background: transparent;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 8px;
        }

        .tree-item:hover {
            background: var(--bg);
            border-color: var(--border);
        }

        .tree-item.current {
            background: #dbeafe;
            border-color: #93c5fd;
        }

        .tree-item.completed {
            background: #ecfdf5;
            border-color: #bbf7d0;
        }

        .tree-item.dimmed {
            opacity: 0.4;
        }

        .tree-dot {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            border: 2px solid var(--border);
            margin-top: 2px;
            flex: 0 0 18px;
            display: grid;
            place-items: center;
            font-size: 11px;
        }

        .tree-item.current .tree-dot {
            border-color: var(--primary);
        }

        .tree-item.completed .tree-dot {
            border-color: var(--success);
            color: var(--success);
        }

        .tree-label {
            flex: 1;
        }

        .tree-stepid {
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 2px;
        }

        .tree-stepname {
            font-size: 13px;
            font-weight: 600;
            line-height: 1.3;
        }

        .steps-panel {
            flex: 1;
            min-width: 0;
        }

        .step-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
        }

        .step-card:hover {
            box-shadow: var(--shadow-md);
        }

        .step-card.current {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
        }

        .step-card.completed {
            background: #ecfdf5;
            border-left: 4px solid var(--success);
        }

        .step-card.dimmed {
            opacity: 0.4;
        }

        .step-card.collapsed {
            padding: 16px 20px;
        }

        .step-card.collapsed .step-content {
            display: none;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .step-title {
            flex: 1;
        }

        .step-id {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .step-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .step-actions {
            display: flex;
            gap: 8px;
        }

        .step-content {
            margin-top: 20px;
        }

        .content-section {
            margin-bottom: 20px;
        }

        .content-section h4 {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .content-section p, .content-section ul {
            font-size: 15px;
            color: var(--text);
        }

        .content-section ul {
            padding-left: 20px;
            margin-top: 8px;
        }

        .content-section li {
            margin-bottom: 5px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin: 16px 0;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .alert-warning {
            background: #fef3c7;
            border-left: 3px solid var(--warning);
            color: #92400e;
        }

        .alert-info {
            background: #dbeafe;
            border-left: 3px solid var(--primary);
            color: #1e3a8a;
        }

        .tool-button {
            background: var(--accent-light);
            color: #92400e;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.2s;
        }

        .tool-button:hover {
            background: var(--accent);
            color: white;
        }

        .collapse-pill {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 8px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: var(--radius);
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h3 {
            font-size: 22px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
        }

        .doc-row {
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 12px;
            background: var(--surface);
        }

        .doc-name {
            font-weight: 600;
            margin-bottom: 6px;
        }

        .doc-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .notes-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            margin-top: 12px;
            font-size: 13px;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stage-layout {
                flex-direction: column;
            }

            .tree-panel {
                width: 100%;
                position: static;
                max-height: none;
            }

            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 36px;
            }

            .hero p {
                font-size: 18px;
            }

            .nav {
                gap: 16px;
            }

            .wizard-container {
                flex-direction: column;
            }

            .controls {
                flex-direction: column;
            }
        }

        /* Upgrade Prompts */
        .upgrade-prompt {
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%);
            border-radius: var(--radius);
            padding: 20px;
            margin: 24px 0;
            color: #78350f;
            text-align: center;
        }

        .upgrade-prompt h4 {
            margin-bottom: 8px;
            font-size: 18px;
        }

        .upgrade-prompt p {
            margin-bottom: 16px;
            color: #92400e;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo" onclick="showSection('home')">
                üõÇ Rahvana
            </a>
            <nav class="nav">
                <a href="#" onclick="showSection('home')">Home</a>
                <a href="#" onclick="showSection('journeys')">Journeys</a>
                <a href="#" onclick="showSection('tools')">Tools</a>
                <a href="#" onclick="showSection('pricing')">Pricing</a>
                <a href="#" onclick="showSection('dashboard')" id="nav-dashboard">Dashboard</a>
            </nav>
            <button class="auth-toggle" onclick="toggleAuth()">
                <span id="auth-text">View as Signed-In</span>
            </button>
        </div>
    </header>

    <!-- HOME SECTION -->
    <section id="home" class="section active">
        <div class="container">
            <!-- Hero -->
            <div class="hero">
                <h1>Your U.S. visa journey, guided step-by-step</h1>
                <p>Navigate complex immigration processes with confidence. From petition to visa, we're with you every step of the way.</p>
                <div class="hero-ctas">
                    <button class="btn btn-primary btn-large" onclick="showSection('journeys')">Explore Visa Journeys ‚Üí</button>
                    <button class="btn btn-secondary btn-large" onclick="showSection('dashboard')" id="hero-dashboard-btn" style="display:none;">Go to Dashboard</button>
                </div>
            </div>

            <!-- How It Works -->
            <h2 style="text-align: center; margin-bottom: 40px; font-size: 32px;">How Rahvana Works</h2>
            <div class="grid grid-3">
                <div class="card">
                    <h3>1Ô∏è‚É£ Choose Your Journey</h3>
                    <p>Select your visa type (IR-1 spouse, IR-5 parents, K-1 fianc√©, and more). We'll show you exactly what to expect.</p>
                </div>
                <div class="card">
                    <h3>2Ô∏è‚É£ Follow Step-by-Step</h3>
                    <p>Each journey is broken into clear stages and steps. No legal jargon‚Äîjust plain guidance on what to do, when, and how.</p>
                </div>
                <div class="card">
                    <h3>3Ô∏è‚É£ Track Your Progress</h3>
                    <p>Mark steps complete, use integrated tools, watch tutorials, and see your progress grow. You're never lost.</p>
                </div>
            </div>

            <!-- Journey Preview -->
            <h2 style="text-align: center; margin-top: 60px; margin-bottom: 40px; font-size: 32px;">Available Journeys</h2>
            <div class="grid grid-3">
                <div class="card journey-card">
                    <div class="journey-status">Active</div>
                    <h3>üá∫üá∏ IR-1/CR-1 Spouse Visa</h3>
                    <p>Bring your spouse to the U.S. via consular processing. Full roadmap for Pakistani beneficiaries.</p>
                    <button class="btn btn-primary" onclick="showSection('ir1-journey')">Start Journey ‚Üí</button>
                </div>
                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üë®‚Äçüë©‚Äçüëß IR-5 Parent Visa</h3>
                    <p>Sponsor your parents to join you in the U.S. Complete petition and consular guide.</p>
                    <button class="btn btn-secondary" disabled>Coming Soon</button>
                </div>
                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üíç K-1 Fianc√© Visa</h3>
                    <p>Bring your fianc√© to marry in the U.S. Petition through interview and adjustment.</p>
                    <button class="btn btn-secondary" disabled>Coming Soon</button>
                </div>
            </div>

            <!-- Tools Teaser -->
            <h2 style="text-align: center; margin-top: 60px; margin-bottom: 40px; font-size: 32px;">Helpful Tools at Every Stage</h2>
            <div class="grid grid-3">
                <div class="card">
                    <h3>üì∏ Passport Photo Tool</h3>
                    <p>Convert any photo to U.S. visa format (2"x2", white background, proper sizing).</p>
                    <span class="badge badge-free">Free</span>
                </div>
                <div class="card">
                    <h3>üìÑ Document Naming Helper</h3>
                    <p>CEAC-friendly filenames generated instantly from plain descriptions.</p>
                    <span class="badge badge-free">Free</span>
                </div>
                <div class="card">
                    <h3>üéØ Interview Prep Bank</h3>
                    <p>50+ actual embassy questions with suggested answers and tips.</p>
                    <span class="badge badge-premium">‚≠ê Premium</span>
                </div>
            </div>
            <div style="text-align: center; margin-top: 32px;">
                <button class="btn btn-secondary btn-large" onclick="showSection('tools')">View All Tools ‚Üí</button>
            </div>

            <!-- Trust / FAQ -->
            <div style="margin-top: 80px; padding: 40px; background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border);">
                <h3 style="text-align: center; margin-bottom: 24px; font-size: 28px;">Why People Trust Rahvana</h3>
                <div class="grid grid-2">
                    <div>
                        <h4 style="margin-bottom: 8px;">‚úÖ Official Sources Only</h4>
                        <p style="color: var(--text-light);">Every step links to USCIS, State Department, or U.S. Embassy guidance.</p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üîí Your Data, Your Control</h4>
                        <p style="color: var(--text-light);">Progress saved locally or in cloud (Premium). Export anytime.</p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üåç Built for Pakistan</h4>
                        <p style="color: var(--text-light);">Pakistan-specific guidance (police certificates, IOM medical, Islamabad embassy).</p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 8px;">üö´ No Legal Advice</h4>
                        <p style="color: var(--text-light);">We're an educational tool, not attorneys. Consult a lawyer for legal advice.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- JOURNEYS OVERVIEW SECTION -->
    <section id="journeys" class="section">
        <div class="container">
            <h1 style="font-size: 40px; margin-bottom: 16px;">Visa Journeys</h1>
            <p style="color: var(--text-light); font-size: 18px; margin-bottom: 48px;">Choose your visa type to start your guided journey.</p>

            <div class="grid grid-2">
                <div class="card journey-card">
                    <div class="journey-status">Active</div>
                    <h3>üá∫üá∏ IR-1/CR-1 Spouse Visa</h3>
                    <p><strong>For:</strong> U.S. citizens petitioning foreign spouse<br>
                    <strong>Timeline:</strong> 18-36 months average<br>
                    <strong>Process:</strong> USCIS ‚Üí NVC ‚Üí Consular Interview ‚Üí Visa</p>
                    <p style="margin-top: 12px;">Complete roadmap for Pakistani beneficiaries via U.S. Embassy Islamabad with stage-by-stage guidance, document vault, and tools.</p>
                    <button class="btn btn-primary btn-large" onclick="showSection('ir1-journey')" style="margin-top: 16px;">Start IR-1 Journey ‚Üí</button>
                </div>

                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üë®‚Äçüë©‚Äçüëß IR-5 Parent Visa</h3>
                    <p><strong>For:</strong> U.S. citizens sponsoring parents<br>
                    <strong>Timeline:</strong> 12-24 months<br>
                    <strong>Process:</strong> I-130 ‚Üí NVC ‚Üí Interview ‚Üí Green Card</p>
                    <p style="margin-top: 12px;">Bring your parents to live in the U.S. permanently. Full petition and consular processing guide.</p>
                    <button class="btn btn-secondary" disabled style="margin-top: 16px;">Coming Soon</button>
                </div>

                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üíë F2A Spouse of LPR</h3>
                    <p><strong>For:</strong> Green card holders sponsoring spouse<br>
                    <strong>Timeline:</strong> 24-48 months (priority date dependent)<br>
                    <strong>Process:</strong> I-130 ‚Üí Wait for Priority Date ‚Üí NVC ‚Üí Interview</p>
                    <button class="btn btn-secondary" disabled style="margin-top: 16px;">Coming Soon</button>
                </div>

                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üíç K-1 Fianc√© Visa</h3>
                    <p><strong>For:</strong> U.S. citizens bringing fianc√© to marry in U.S.<br>
                    <strong>Timeline:</strong> 12-18 months<br>
                    <strong>Process:</strong> I-129F ‚Üí NVC ‚Üí Interview ‚Üí Entry ‚Üí Marriage ‚Üí AOS</p>
                    <button class="btn btn-secondary" disabled style="margin-top: 16px;">Coming Soon</button>
                </div>

                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üéì F-1 Student Visa</h3>
                    <p><strong>For:</strong> Students accepted to U.S. universities<br>
                    <strong>Timeline:</strong> 2-6 months<br>
                    <strong>Process:</strong> I-20 ‚Üí SEVIS ‚Üí Interview ‚Üí Entry</p>
                    <button class="btn btn-secondary" disabled style="margin-top: 16px;">Coming Soon</button>
                </div>

                <div class="card journey-card">
                    <div class="journey-status coming-soon">Coming Soon</div>
                    <h3>üåç More Coming...</h3>
                    <p>We're adding more visa types based on community demand. Want to see a specific journey? Let us know!</p>
                    <button class="btn btn-secondary" disabled style="margin-top: 16px;">Stay Tuned</button>
                </div>
            </div>
        </div>
    </section>

    <!-- IR-1 JOURNEY DETAIL + WIZARD SECTION -->
    <section id="ir1-journey" class="section">
        <div class="container-narrow" style="margin-bottom: 40px;">
            <h1 style="font-size: 40px; margin-bottom: 16px;">IR-1/CR-1 Spouse Visa Journey</h1>
            <p style="color: var(--text-light); font-size: 18px; margin-bottom: 24px;">
                Comprehensive roadmap for bringing your spouse to the United States via consular processing at U.S. Embassy Islamabad, Pakistan.
            </p>

            <div class="alert alert-info">
                <span>‚ÑπÔ∏è</span>
                <div>
                    <strong>IR-1 vs CR-1:</strong> If married less than 2 years at entry, you'll receive CR-1 (conditional, 2-year green card requiring I-751 filing). If married 2+ years, IR-1 (10-year green card).
                </div>
            </div>

            <!-- High-Level Stages -->
            <h3 style="margin-top: 40px; margin-bottom: 16px;">The 5 Stages</h3>
            <div class="grid grid-3" style="margin-bottom: 32px;">
                <div class="card">
                    <h4 style="color: var(--primary);">Stage I</h4>
                    <p style="font-weight: 600;">USCIS Petition</p>
                    <p style="font-size: 14px; color: var(--text-light);">17-65 months</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--primary);">Stage II</h4>
                    <p style="font-weight: 600;">NVC/CEAC Processing</p>
                    <p style="font-size: 14px; color: var(--text-light);">4-9 months</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--primary);">Stage III</h4>
                    <p style="font-weight: 600;">Medical + Interview</p>
                    <p style="font-size: 14px; color: var(--text-light);">2-4 weeks</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--primary);">Stage IV</h4>
                    <p style="font-weight: 600;">Post-Interview & Travel</p>
                    <p style="font-size: 14px; color: var(--text-light);">1-2 weeks</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--primary);">Stage V</h4>
                    <p style="font-weight: 600;">U.S. Arrival</p>
                    <p style="font-size: 14px; color: var(--text-light);">90 days</p>
                </div>
            </div>

            <!-- Video Placeholder: Overview -->
            <div class="video-placeholder">
                <h4>üìπ Video: Welcome to Your IR-1 Journey (5 min)</h4>
                <ul>
                    <li><strong>Goals:</strong> Understand the 5 stages, set realistic expectations, feel supported</li>
                    <li><strong>Target:</strong> Both petitioner and beneficiary</li>
                    <li><strong>Topics:</strong> Timeline overview, cost breakdown, common mistakes to avoid, emotional support for separated couples</li>
                </ul>
                <button class="video-play-btn" disabled>‚ñ∂ Play Video (Placeholder)</button>
            </div>

            <div id="guest-wizard-prompt" style="display:none;">
                <div class="upgrade-prompt">
                    <h4>üîì Full Wizard Access</h4>
                    <p>Sign in free to save your progress, mark steps complete, and use the document vault.</p>
                    <button class="btn btn-primary" onclick="toggleAuth()">Sign In Free</button>
                </div>
            </div>
        </div>

        <!-- INTEGRATED WIZARD -->
        <div class="container" id="wizard-app">
            <div class="wizard-container">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-logo">üá∫üá∏ IR-1 Wizard</div>
                    
                    <div class="progress-summary">
                        <div style="font-size: 12px; color: var(--text-light); margin-bottom: 6px;">Overall Progress</div>
                        <div style="font-size: 20px; font-weight: 700;" id="overall-progress">0/52</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>

                    <ul class="stage-nav" id="stage-nav"></ul>

                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px; font-size: 13px;" onclick="openModal('checklist')">üìã Documents</button>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px; font-size: 13px;" onclick="openModal('standards')">üìè File Standards</button>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px; font-size: 13px;" onclick="exportProgress()">üíæ Export</button>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px; font-size: 13px;" onclick="importProgress()">üì• Import</button>
                        <button class="btn btn-secondary" style="width: 100%; font-size: 13px;" onclick="resetData()">üîÑ Reset</button>
                    </div>
                </div>

                <!-- Main Wizard Content -->
                <div class="wizard-main">
                    <div class="wizard-header">
                        <h2 id="stage-title">Stage I: USCIS Petition</h2>
                        <p id="stage-description">File Form I-130 to establish the qualifying marriage relationship</p>
                    </div>

                    <div class="controls">
                        <div class="search-box">
                            <input type="text" id="search" placeholder="üîç Search steps..." oninput="filterSteps()">
                        </div>
                        
                        <div class="toggle-group">
                            <span style="font-size: 13px; color: var(--text-light);">I am:</span>
                            <button class="toggle-btn active" data-role="both" onclick="setRole('both')">Both</button>
                            <button class="toggle-btn" data-role="petitioner" onclick="setRole('petitioner')">Petitioner</button>
                            <button class="toggle-btn" data-role="beneficiary" onclick="setRole('beneficiary')">Beneficiary</button>
                        </div>

                        <div class="toggle-group">
                            <span style="font-size: 13px; color: var(--text-light);">Filing:</span>
                            <button class="toggle-btn active" data-filing="online" onclick="setFiling('online')">Online</button>
                            <button class="toggle-btn" data-filing="paper" onclick="setFiling('paper')">Paper</button>
                        </div>
                    </div>

                    <div class="stage-layout">
                        <div class="tree-panel">
                            <div class="tree-title">Progress Tree</div>
                            <div class="tree-subtitle">Click to jump</div>
                            <div id="progress-tree"></div>
                        </div>
                        <div class="steps-panel">
                            <div id="steps-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- TOOLS HUB SECTION -->
    <section id="tools" class="section">
        <div class="container">
            <h1 style="font-size: 40px; margin-bottom: 16px;">Tools Hub</h1>
            <p style="color: var(--text-light); font-size: 18px; margin-bottom: 48px;">Integrated tools to simplify your visa journey. Use them standalone or access directly from wizard steps.</p>

            <h3 style="margin-bottom: 24px;">üì∏ Document Preparation Tools</h3>
            <div class="grid grid-3">
                <div class="card">
                    <h3>Passport Photo Tool</h3>
                    <p>Convert any photo to U.S. visa specs: 2"x2", white background, proper cropping and sizing.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage I, II, III</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Open Tool ‚Üí</button>
                </div>

                <div class="card">
                    <h3>PDF Processing Tool</h3>
                    <p>Merge, compress, convert PDFs to meet CEAC 4MB limit. Batch process multiple documents.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage II</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Open Tool ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Signature Extractor</h3>
                    <p>Extract signature from scanned document, remove background, save as transparent PNG.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage II</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Open Tool ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Document Naming Helper</h3>
                    <p>Enter "my birth certificate" ‚Üí get "BirthCert_Khan_2025-12-13.pdf" (CEAC-friendly format).</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage II</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Open Tool ‚Üí</button>
                </div>
            </div>

            <h3 style="margin-top: 48px; margin-bottom: 24px;">üìù Templates & Generators</h3>
            <div class="grid grid-3">
                <div class="card">
                    <h3>Police Certificate Request Letter</h3>
                    <p>Generate formal request letter for Pakistani police certificate with your details auto-filled.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-premium">‚≠ê Premium</span>
                        <span class="badge badge-stage">Stage I, III</span>
                    </div>
                    <button class="btn btn-accent" style="margin-top: 16px;">Generate Letter ‚Üí</button>
                </div>

                <div class="card">
                    <h3>NVC Document Checklist Builder</h3>
                    <p>Dynamic checklist based on your case specifics (joint sponsor? previous marriage? kids?).</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-premium">‚≠ê Premium</span>
                        <span class="badge badge-stage">Stage II</span>
                    </div>
                    <button class="btn btn-accent" style="margin-top: 16px;">Build Checklist ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Email Templates Library</h3>
                    <p>Pre-written emails for contacting NVC, Embassy, IOM, attorneys. Copy and customize.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-premium">‚≠ê Premium</span>
                        <span class="badge badge-stage">All Stages</span>
                    </div>
                    <button class="btn btn-accent" style="margin-top: 16px;">View Templates ‚Üí</button>
                </div>
            </div>

            <h3 style="margin-top: 48px; margin-bottom: 24px;">üéØ Preparation & Planning</h3>
            <div class="grid grid-3">
                <div class="card">
                    <h3>I-864 Income Calculator</h3>
                    <p>Calculate 125% poverty guideline for your household size. Lists exact documents needed for your situation.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage II</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Calculate Requirements ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Interview Prep Question Bank</h3>
                    <p>50+ actual Islamabad embassy questions with suggested answers, tips, and what NOT to say.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-premium">‚≠ê Premium</span>
                        <span class="badge badge-stage">Stage III</span>
                    </div>
                    <button class="btn btn-accent" style="margin-top: 16px;">Practice Now ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Timeline Estimator</h3>
                    <p>Visual timeline with current processing times. Non-promissory‚Äîjust realistic expectations.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">All Stages</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">View Timeline ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Visa Checker</h3>
                    <p>Answer questions about your situation ‚Üí get recommended visa type and journey.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Pre-Journey</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Check Eligibility ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Post-Arrival 90-Day Checklist</h3>
                    <p>SSN, driver's license, bank account, green card arrival, I-751 reminder (CR-1), travel rules.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage V</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">View Checklist ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Embassy Prep Checklist</h3>
                    <p>What to bring, what NOT to bring (no phones!), dress code, security procedures for Islamabad.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage III</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">View Checklist ‚Üí</button>
                </div>
            </div>

            <h3 style="margin-top: 48px; margin-bottom: 24px;">üìã Original Tools (Migrated)</h3>
            <div class="grid grid-3">
                <div class="card">
                    <h3>IV Tool</h3>
                    <p>Interview scheduling and tracking tool for visa appointments.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">Stage III</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">Open Tool ‚Üí</button>
                </div>

                <div class="card">
                    <h3>Visa Forms Library</h3>
                    <p>Download blank forms (DS-260, I-130, I-130A, I-864) with instructions.</p>
                    <div class="tool-card-tags">
                        <span class="badge badge-free">Free</span>
                        <span class="badge badge-stage">All Stages</span>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 16px;">View Forms ‚Üí</button>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD SECTION (Signed-In Only) -->
    <section id="dashboard" class="section">
        <div class="container">
            <h1 style="font-size: 40px; margin-bottom: 16px;">Your Dashboard</h1>
            <p style="color: var(--text-light); font-size: 18px; margin-bottom: 48px;">Track your active journeys and access recommended tools.</p>

            <div id="guest-dashboard-msg" style="display:none;">
                <div class="upgrade-prompt">
                    <h4>üëã Sign in to access your dashboard</h4>
                    <p>Track journeys, save progress across devices, and get personalized recommendations.</p>
                    <button class="btn btn-primary" onclick="toggleAuth()">Sign In Free</button>
                </div>
            </div>

            <div id="signed-in-dashboard">
                <!-- Video Placeholder: Getting Started -->
                <div class="video-placeholder" style="margin-bottom: 40px;">
                    <h4>üìπ Getting Started with Rahvana (3 min)</h4>
                    <ul>
                        <li><strong>Goals:</strong> Quick platform tour, how to use wizard, where to find tools</li>
                        <li><strong>Target:</strong> New users</li>
                        <li><strong>Topics:</strong> Dashboard overview, starting your first journey, marking steps complete, using document vault</li>
                    </ul>
                    <button class="video-play-btn" disabled>‚ñ∂ Play Video (Placeholder)</button>
                </div>

                <div class="dashboard-grid">
                    <div>
                        <h3 style="margin-bottom: 20px;">Your Active Journeys</h3>
                        <div class="progress-card">
                            <h4 style="font-size: 18px; margin-bottom: 8px;">üá∫üá∏ IR-1/CR-1 Spouse Visa</h4>
                            <p style="color: var(--text-light); font-size: 14px; margin-bottom: 12px;">Started Dec 13, 2025</p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="dashboard-progress" style="width: 0%"></div>
                            </div>
                            <p style="font-size: 14px; margin-top: 8px; color: var(--text-light);"><span id="dashboard-steps">0 of 52</span> steps complete</p>
                            <button class="btn btn-primary" style="margin-top: 16px;" onclick="showSection('ir1-journey')">Continue Journey ‚Üí</button>
                        </div>

                        <div class="card" style="margin-top: 24px; opacity: 0.6;">
                            <h4>‚ûï Start Another Journey</h4>
                            <p style="font-size: 14px; color: var(--text-light);">IR-5 Parents, K-1 Fianc√©, and more coming soon.</p>
                            <button class="btn btn-secondary" disabled style="margin-top: 12px;">Coming Soon</button>
                        </div>
                    </div>

                    <div>
                        <h3 style="margin-bottom: 20px;">Tools You May Need Next</h3>
                        <div class="card" style="margin-bottom: 16px;">
                            <h4 style="font-size: 16px; margin-bottom: 8px;">üì∏ Passport Photo Tool</h4>
                            <p style="font-size: 13px; color: var(--text-light);">You'll need 2"x2" photos for Stage I and II.</p>
                            <span class="badge badge-free" style="margin-top: 8px;">Free</span>
                        </div>
                        <div class="card" style="margin-bottom: 16px;">
                            <h4 style="font-size: 16px; margin-bottom: 8px;">üí∞ I-864 Calculator</h4>
                            <p style="font-size: 13px; color: var(--text-light);">Calculate income requirements early.</p>
                            <span class="badge badge-free" style="margin-top: 8px;">Free</span>
                        </div>
                        <div class="card">
                            <h4 style="font-size: 16px; margin-bottom: 8px;">üéØ Interview Prep</h4>
                            <p style="font-size: 13px; color: var(--text-light);">Start preparing early with 50+ questions.</p>
                            <span class="badge badge-premium" style="margin-top: 8px;">‚≠ê Premium</span>
                        </div>

                        <div style="margin-top: 32px; text-align: center;">
                            <button class="btn btn-secondary" onclick="showSection('tools')">View All Tools ‚Üí</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 48px;">
                    <h3 style="margin-bottom: 20px;">Quick Actions</h3>
                    <div class="grid grid-3">
                        <button class="card" onclick="showSection('ir1-journey')" style="cursor: pointer; text-align: center;">
                            <h4 style="font-size: 18px;">üìã Open IR-1 Wizard</h4>
                            <p style="font-size: 14px; color: var(--text-light);">Continue your journey</p>
                        </button>
                        <button class="card" onclick="showSection('tools')" style="cursor: pointer; text-align: center;">
                            <h4 style="font-size: 18px;">üõ†Ô∏è Browse Tools</h4>
                            <p style="font-size: 14px; color: var(--text-light);">Document prep & planning</p>
                        </button>
                        <button class="card" onclick="showSection('pricing')" style="cursor: pointer; text-align: center;">
                            <h4 style="font-size: 18px;">‚≠ê View Premium</h4>
                            <p style="font-size: 14px; color: var(--text-light);">Unlock all features</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PRICING SECTION -->
    <section id="pricing" class="section">
        <div class="container">
            <h1 style="font-size: 40px; margin-bottom: 16px; text-align: center;">Simple, Transparent Pricing</h1>
            <p style="color: var(--text-light); font-size: 18px; margin-bottom: 40px; text-align: center;">Start free. Upgrade when you need more.</p>

            <div class="pricing-toggle">
                <button class="active" onclick="togglePricing('monthly')">Monthly</button>
                <button onclick="togglePricing('yearly')">Yearly (Save 25%)</button>
            </div>

            <div class="grid grid-3">
                <!-- Free Plan -->
                <div class="card pricing-card">
                    <h3>Free</h3>
                    <div class="price">$0<span class="price-period">/month</span></div>
                    <p style="color: var(--text-light); margin-bottom: 24px;">Perfect to get started</p>
                    <ul>
                        <li>Full IR-1 wizard roadmap</li>
                        <li>All 52 steps with detailed guidance</li>
                        <li>Progress tracking (browser only)</li>
                        <li>Document vault with checklists</li>
                        <li>Basic tools (Photo, Calculator, Naming)</li>
                        <li>1 tutorial video</li>
                        <li>Export/import progress (JSON)</li>
                        <li>Community forum access</li>
                    </ul>
                    <button class="btn btn-secondary btn-large" style="width: 100%; margin-top: 24px;">Get Started Free</button>
                </div>

                <!-- Plus Plan -->
                <div class="card pricing-card featured">
                    <div style="background: var(--primary); color: white; padding: 6px 16px; border-radius: 999px; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); font-size: 13px; font-weight: 600;">Most Popular</div>
                    <h3>Plus</h3>
                    <div class="price">
                        <span id="plus-price-monthly">$9.99</span>
                        <span id="plus-price-yearly" style="display:none;">$89</span>
                        <span class="price-period">/month</span>
                    </div>
                    <p style="color: var(--text-light); margin-bottom: 24px;">For serious journey trackers</p>
                    <ul>
                        <li><strong>Everything in Free, plus:</strong></li>
                        <li>‚òÅÔ∏è Cloud sync across all devices</li>
                        <li>üìπ Full video tutorial library (5 videos)</li>
                        <li>üéØ Interview Prep Question Bank</li>
                        <li>üìù NVC Checklist Builder</li>
                        <li>‚úâÔ∏è Police Certificate Letter Generator</li>
                        <li>üíæ Cloud document vault backup</li>
                        <li>üöÄ Early access to new journeys</li>
                        <li>üìß Email support (48hr response)</li>
                    </ul>
                    <button class="btn btn-primary btn-large" style="width: 100%; margin-top: 24px;">Upgrade to Plus ‚Üí</button>
                </div>

                <!-- Pro Plan -->
                <div class="card pricing-card">
                    <h3>Pro</h3>
                    <div class="price">
                        <span id="pro-price-monthly">$19.99</span>
                        <span id="pro-price-yearly" style="display:none;">$179</span>
                        <span class="price-period">/month</span>
                    </div>
                    <p style="color: var(--text-light); margin-bottom: 24px;">For complex cases</p>
                    <ul>
                        <li><strong>Everything in Plus, plus:</strong></li>
                        <li>üë®‚Äçüë©‚Äçüëß Multiple journey tracking</li>
                        <li>üìÑ Premium template library</li>
                        <li>üåê Joint sponsor finder network</li>
                        <li>üìû Priority support (24hr response)</li>
                        <li>üé• 1-on-1 onboarding call (30 min)</li>
                        <li>üîó Share timeline with attorney/family</li>
                        <li>üìä Advanced analytics & insights</li>
                        <li>‚ú® Remove "Powered by Rahvana"</li>
                    </ul>
                    <button class="btn btn-accent btn-large" style="width: 100%; margin-top: 24px;">Go Pro ‚Üí</button>
                </div>
            </div>

            <div style="margin-top: 60px; max-width: 700px; margin-left: auto; margin-right: auto;">
                <h3 style="text-align: center; margin-bottom: 24px;">Payment Information</h3>
                <div class="card">
                    <p style="margin-bottom: 12px;"><strong>Accepted Payment Methods:</strong></p>
                    <ul style="padding-left: 20px; color: var(--text-light);">
                        <li>Credit/Debit Cards (Visa, Mastercard, Amex) via Stripe</li>
                        <li>PayPal</li>
                        <li>Regional payment methods for Pakistani users (JazzCash, Easypaisa) under evaluation</li>
                    </ul>
                    <p style="margin-top: 16px; font-size: 14px; color: var(--text-light);">
                        üí° All plans include 14-day money-back guarantee. Cancel anytime. No hidden fees.
                    </p>
                </div>
            </div>

            <div style="margin-top: 60px; max-width: 900px; margin-left: auto; margin-right: auto;">
                <h3 style="text-align: center; margin-bottom: 32px;">Frequently Asked Questions</h3>
                <div class="grid grid-2">
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">How does Rahvana help simplify my visa journey?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">Rahvana acts as your personal digital guide, breaking down the complex U.S. immigration process into clear, manageable steps with localized roadmaps and AI-powered automation.</p>
                    </div>
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">Is the Roadmap tailored for the Islamabad Embassy?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">Yes! Rahvana includes specific guidance for Pakistan, including NADRA document requirements, Union Council registrations, and local police certificate procedures.</p>
                    </div>
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">Can Rahvana really auto-fill my USCIS forms?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">Absolutely. Our AI 'Brain' takes your profile data and maps it directly onto official USCIS PDFs like the I-130, generating a perfectly filled form in seconds.</p>
                    </div>
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">Does Rahvana provide legal representation?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">No, Rahvana is an educational AI assistant designed to simplify your journey. We recommend consulting a licensed attorney for complex legal cases.</p>
                    </div>
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">How accurate is the Interview Prep Question Bank?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">Our bank contains 50+ real-world questions from the Islamabad Embassy, with tips on how to answer honestly and effectively based on successful cases.</p>
                    </div>
                    <div class="card">
                        <h4 style="margin-bottom: 8px;">Is my document data secure in the Vault?</h4>
                        <p style="font-size: 14px; color: var(--text-light);">Yes. We use bank-level encryption. For Free users, data stays in the browser; Plus users get secure cloud sync across all their devices.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- MODALS -->
    <div class="modal" id="checklist-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Document Vault</h3>
                <button class="close-btn" onclick="closeModal('checklist')">√ó</button>
            </div>
            <div id="checklist-content"></div>
        </div>
    </div>

    <div class="modal" id="standards-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìè File Standards & Scanning Rules</h3>
                <button class="close-btn" onclick="closeModal('standards')">√ó</button>
            </div>
            <div style="background: var(--bg); padding: 20px; border-radius: var(--radius-sm);">
                <h4 style="margin-bottom: 12px;">CEAC Upload Requirements:</h4>
                <ul style="padding-left: 20px; color: var(--text); line-height: 1.8;">
                    <li>Maximum file size: 4 MB per file</li>
                    <li>Formats: PDF (preferred) or JPEG</li>
                    <li>Resolution: 300 DPI minimum, 600 DPI recommended</li>
                    <li>Color scans required for stamps/seals</li>
                    <li>All 4 corners visible, no shadows</li>
                    <li>No password-protected or zipped files</li>
                </ul>
                <h4 style="margin-top: 24px; margin-bottom: 12px;">File Naming Convention:</h4>
                <ul style="padding-left: 20px; color: var(--text); line-height: 1.8;">
                    <li>Format: [DocumentType]_[LastName]_[Date].pdf</li>
                    <li>Example: BirthCertificate_Khan_2025-12-13.pdf</li>
                    <li>Example: NikahNama_Translation_Khan_2025-12-13.pdf</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-content">
            <div class="disclaimer">
                <p><strong>‚öñÔ∏è Legal Disclaimer:</strong> Rahvana is not a law firm and does not provide legal advice. All information provided is for educational purposes only and should not be construed as legal advice. Immigration laws are complex and subject to change. For legal guidance specific to your situation, please consult a licensed immigration attorney. Use of this platform does not create an attorney-client relationship.</p>
            </div>

            <div style="text-align: center; color: rgba(255,255,255,0.9); margin-bottom: 16px;">
                <p style="font-size: 16px; font-weight: 600;">üõÇ Rahvana</p>
                <p style="font-size: 14px; margin-top: 8px;">Your visa journey companion</p>
            </div>

            <div class="footer-links">
                <a href="#">Terms of Service</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Contact Us</a>
                <a href="#">About Rahvana</a>
            </div>

            <div style="text-align: center; margin-top: 24px; color: rgba(255,255,255,0.6); font-size: 13px;">
                ¬© 2025 Rahvana. All rights reserved. | Last updated: December 2025
            </div>
        </div>
    </footer>

    <script>
        // ============================================================================
        // NAVIGATION & AUTH STATE
        // ============================================================================
        let isSignedIn = false;

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Show/hide dashboard nav link
            const dashLink = document.getElementById('nav-dashboard');
            if (sectionId === 'dashboard' || isSignedIn) {
                dashLink.style.display = 'inline';
            }

            // Handle guest vs signed-in
            if (sectionId === 'dashboard') {
                updateDashboard();
            }

            if (sectionId === 'ir1-journey') {
                updateWizardPrompts();
                renderStage();
            }
        }

        function toggleAuth() {
            isSignedIn = !isSignedIn;
            const authText = document.getElementById('auth-text');
            authText.textContent = isSignedIn ? 'View as Guest' : 'View as Signed-In';

            // Update UI
            document.getElementById('hero-dashboard-btn').style.display = isSignedIn ? 'inline-block' : 'none';
            document.getElementById('nav-dashboard').style.display = isSignedIn ? 'inline' : 'none';

            updateDashboard();
            updateWizardPrompts();
        }

        function updateDashboard() {
            const guestMsg = document.getElementById('guest-dashboard-msg');
            const signedInDash = document.getElementById('signed-in-dashboard');
            
            if (isSignedIn) {
                guestMsg.style.display = 'none';
                signedInDash.style.display = 'block';
                updateDashboardProgress();
            } else {
                guestMsg.style.display = 'block';
                signedInDash.style.display = 'none';
            }
        }

        function updateWizardPrompts() {
            const guestPrompt = document.getElementById('guest-wizard-prompt');
            if (guestPrompt) {
                guestPrompt.style.display = isSignedIn ? 'none' : 'block';
            }
        }

        function updateDashboardProgress() {
            const totalSteps = getTotalSteps();
            const completed = state.completedSteps.size;
            const percent = totalSteps === 0 ? 0 : Math.round((completed / totalSteps) * 100);

            const progressFill = document.getElementById('dashboard-progress');
            const stepsText = document.getElementById('dashboard-steps');
            
            if (progressFill) progressFill.style.width = `${percent}%`;
            if (stepsText) stepsText.textContent = `${completed} of ${totalSteps}`;
        }

        function togglePricing(period) {
            document.querySelectorAll('.pricing-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (period === 'yearly') {
                document.getElementById('plus-price-monthly').style.display = 'none';
                document.getElementById('plus-price-yearly').style.display = 'inline';
                document.getElementById('pro-price-monthly').style.display = 'none';
                document.getElementById('pro-price-yearly').style.display = 'inline';
            } else {
                document.getElementById('plus-price-monthly').style.display = 'inline';
                document.getElementById('plus-price-yearly').style.display = 'none';
                document.getElementById('pro-price-monthly').style.display = 'inline';
                document.getElementById('pro-price-yearly').style.display = 'none';
            }
        }

        // ============================================================================
        // WIZARD STATE & DATA (FROM ORIGINAL FILE - PRESERVED EXACTLY)
        // ============================================================================
        const roadmapData = {
            stages: [
                {
                    id: 1,
                    name: "Stage I: USCIS Petition",
                    description: "U.S. Petitioner files I-130 ‚Üí USCIS processes ‚Üí Approval",
                    timeline: "17-65 months average",
                    steps: [
                        {
                            id: "I-01",
                            name: "Determine Eligibility",
                            who: "Both",
                            where: "Self-assessment",
                            actions: ["Verify petitioner is U.S. citizen", "Confirm legal marriage exists", "Verify marriage is bona fide", "Check domicile requirements", "Confirm no bars to immigration"],
                            output: "Eligibility confirmed",
                            notes: "Petitioner must be U.S. citizen (not green card holder). Marriage must be legal and genuine."
                        },
                        {
                            id: "I-02",
                            name: "Gather Required Documents",
                            who: "Both",
                            where: "Various sources",
                            timeline: "4-8 weeks",
                            actions: ["Collect proof of U.S. citizenship", "Obtain Pakistani passport", "Get NADRA birth certificate", "Obtain Nikah Nama + translation", "Get Union Council marriage registration", "Apply for police certificate", "Take passport photos"],
                            documents: ["U.S. Passport/Birth Certificate", "Pakistani Passport", "NADRA Birth Certificate", "Nikah Nama (original)", "English translation of Nikah Nama", "Union Council Marriage Registration", "Police Certificate", "Passport Photos (2x2 inches)"],
                            pakistanSpecific: "Union Council registration increasingly required by Islamabad Embassy. Police certificate: 3-7 days processing for Punjab/Islamabad."
                        },
                        {
                            id: "I-03",
                            name: "Decide Filing Method",
                            who: "Petitioner",
                            where: "Decision point",
                            actions: ["Compare online ($625) vs paper ($675)", "Consider processing speed", "Choose filing method"],
                            fee: "Online: $625, Paper: $675",
                            notes: "Online filing recommended - faster receipt, lower fee, electronic tracking"
                        },
                        {
                            id: "I-04",
                            name: "Complete Form I-130",
                            who: "Petitioner",
                            where: "my.uscis.gov or paper",
                            timeline: "2-4 hours",
                            filingType: "both",
                            actions: ["Create USCIS account (if online)", "Complete Part 1: Relationship", "Complete Part 2: Petitioner information", "Complete Part 3: Beneficiary information", "Complete Parts 4-10", "Review all information", "Upload supporting documents"],
                            inputs: ["Petitioner citizenship proof", "Marriage evidence", "Relationship photos", "Communication records"],
                            output: "Completed I-130 form",
                            officialSource: "https://www.uscis.gov/i-130"
                        },
                        {
                            id: "I-05",
                            name: "Complete Form I-130A",
                            who: "Beneficiary",
                            where: "Online or paper with I-130",
                            actions: ["Provide beneficiary biographic information", "Include parent information", "Provide physical characteristics", "Sign form"],
                            notes: "Always required for spouse petitions, no separate fee"
                        },
                        {
                            id: "I-06",
                            name: "Pay Filing Fee",
                            who: "Petitioner",
                            where: "Pay.gov or Form G-1450/G-1650",
                            fee: "Online: $625, Paper: $675",
                            actions: ["Select payment method", "Enter payment information", "Submit payment", "Save confirmation"],
                            notes: "As of Oct 28, 2025: Checks/money orders NO LONGER accepted. Electronic payment only.",
                            officialSource: "https://www.uscis.gov/g-1055"
                        },
                        {
                            id: "I-07",
                            name: "Submit Application",
                            who: "Petitioner",
                            where: "Online or mail",
                            actions: ["Review entire application", "Verify documents uploaded", "Click Submit (online) or mail package", "Save confirmation/receipt"],
                            output: "Application submitted, confirmation received",
                            nextTrigger: "Receipt notice within 2-4 weeks"
                        },
                        {
                            id: "I-08",
                            name: "Receive Receipt Notice (I-797C)",
                            who: "Petitioner",
                            where: "Mail or online account",
                            timeline: "1-2 weeks (online) or 2-4 weeks (paper)",
                            actions: ["Check mail/account for receipt notice", "Verify all information correct", "Save receipt number", "Note priority date"],
                            output: "Receipt number obtained",
                            notes: "Receipt number starts with IOE (online) or WAC/EAC/SRC (paper)"
                        },
                        {
                            id: "I-09",
                            name: "Wait for Processing",
                            who: "Both",
                            where: "Current locations",
                            timeline: "14.8 months average (17-65 months range)",
                            actions: ["Check case status weekly", "Respond to any RFE immediately", "Keep address updated", "Gather NVC documents meanwhile"],
                            notes: "RFE deadline usually 30-87 days. Respond promptly to avoid delays."
                        },
                        {
                            id: "I-10",
                            name: "Receive Approval Notice (I-797)",
                            who: "Petitioner",
                            where: "Mail",
                            actions: ["Receive approval notice", "Make multiple copies", "Wait for NVC contact (4-6 weeks)", "Begin Stage II preparation"],
                            output: "I-130 approved",
                            nextTrigger: "Case transferred to NVC"
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Stage II: NVC/CEAC Processing",
                    description: "Pay fees ‚Üí Submit DS-260 ‚Üí Upload documents ‚Üí Documentarily Qualified",
                    timeline: "4-9 months",
                    steps: [
                        {
                            id: "II-01",
                            name: "Receive NVC Welcome Letter",
                            who: "Petitioner",
                            where: "Email + physical mail",
                            timeline: "4-6 weeks after I-130 approval",
                            actions: ["Check email (including spam)", "Note Case Number (ISL...)", "Note Invoice ID Number", "Save both numbers securely"],
                            output: "Case Number and Invoice ID obtained",
                            notes: "Case Number starts with ISL for Islamabad"
                        },
                        {
                            id: "II-02",
                            name: "Create CEAC Account",
                            who: "Either",
                            where: "ceac.state.gov",
                            actions: ["Navigate to CEAC portal", "Create account", "Enter Invoice ID", "Enter SSN and DOB", "Add case to account"],
                            output: "CEAC account active with case",
                            officialSource: "https://ceac.state.gov"
                        },
                        {
                            id: "II-03",
                            name: "Choose Agent (Optional)",
                            who: "Both",
                            where: "CEAC portal",
                            actions: ["Decide: self-representation or attorney", "If attorney: complete DS-261", "If self: proceed to fees"],
                            notes: "Most straightforward cases use self-representation"
                        },
                        {
                            id: "II-04",
                            name: "Pay NVC Fees",
                            who: "Petitioner",
                            where: "CEAC portal or Pay.gov",
                            fee: "AOS Fee: $120, IV Fee: $345, Total: $465",
                            actions: ["Log into CEAC", "Pay Affidavit of Support fee ($120)", "Pay Immigrant Visa fee ($345)", "Save payment confirmations"],
                            output: "Both fees paid, forms unlocked",
                            notes: "Fees are non-refundable. Payment reflects in 1-2 business days."
                        },
                        {
                            id: "II-05",
                            name: "Complete DS-260 Form",
                            who: "Beneficiary",
                            where: "CEAC portal",
                            timeline: "2-4 hours",
                            actions: ["Access DS-260 in CEAC", "Complete all 24 parts", "Answer security questions truthfully", "Review entire application", "Sign and submit electronically"],
                            inputs: ["Passport", "Travel history", "Employment history (10 years)", "Address history (5 years)", "Education history"],
                            output: "DS-260 submitted",
                            notes: "Cannot change after submission except via NVC email. Save frequently!",
                            pakistanSpecific: "Select post: Islamabad, Pakistan"
                        },
                        {
                            id: "II-06",
                            name: "Prepare Civil Documents",
                            who: "Both",
                            where: "Document gathering",
                            documents: ["Birth certificate (NADRA)", "Marriage certificate (Nikah Nama + translation + Union Council)", "Police certificate (original)", "Passport biographical page", "Previous marriage termination (if applicable)"],
                            actions: ["Scan all documents (300 DPI, PDF)", "Ensure translations certified", "Verify all stamps/seals visible", "Name files clearly"],
                            pakistanSpecific: "Police certificate valid 1 year. Union Council registration increasingly required."
                        },
                        {
                            id: "II-07",
                            name: "Complete I-864 Affidavit",
                            who: "Petitioner",
                            where: "Download, complete, scan",
                            actions: ["Download I-864 form", "Complete all parts", "Gather IRS tax transcripts (3 years)", "Get employment letter", "Collect pay stubs (6 months)", "Sign form"],
                            inputs: ["Tax transcripts", "Employment letter", "Pay stubs", "W-2 forms", "Bank statements (if showing assets)"],
                            notes: "Minimum income: $25,550 for household of 2 (2025). Use joint sponsor if needed.",
                            officialSource: "https://www.uscis.gov/i-864"
                        },
                        {
                            id: "II-08",
                            name: "Upload Documents to CEAC",
                            who: "Either",
                            where: "CEAC portal",
                            actions: ["Log into CEAC", "Navigate to Documents section", "Upload each document category", "Verify upload success", "Check for green checkmarks"],
                            output: "All documents uploaded",
                            notes: "Upload one at a time. Max 4 MB per file. PDF preferred."
                        },
                        {
                            id: "II-09",
                            name: "Review and Submit Documents",
                            who: "Either",
                            where: "CEAC portal",
                            actions: ["Review all uploaded documents", "Verify translations included", "Check financial documents sufficient", "Click Submit Documents", "Save confirmation"],
                            output: "Documents submitted to NVC",
                            nextTrigger: "NVC reviews documents"
                        },
                        {
                            id: "II-10",
                            name: "NVC Document Review",
                            who: "NVC",
                            where: "Background process",
                            timeline: "2-8 weeks",
                            actions: ["Monitor CEAC status weekly", "Check email for updates", "Respond to any document requests immediately"],
                            possibleOutcomes: ["Documentarily Qualified (DQ)", "Request for additional documents", "Document rejection"],
                            notes: "Common rejections: poor scan quality, missing translations, expired police certificate"
                        },
                        {
                            id: "II-11",
                            name: "Receive DQ Status",
                            who: "Both",
                            where: "Email + CEAC",
                            actions: ["Receive DQ confirmation email", "Verify CEAC shows DQ status", "Note DQ date", "Begin interview preparation"],
                            output: "Documentarily Qualified",
                            nextTrigger: "Case sent to Embassy Islamabad"
                        },
                        {
                            id: "II-12",
                            name: "Wait for Interview Scheduling",
                            who: "Embassy",
                            where: "Background",
                            timeline: "2-6 months from DQ",
                            actions: ["Check CEAC weekly", "Ensure passport valid", "DO NOT obtain new police certificate yet", "Research interview process"],
                            notes: "Cannot speed up this process. Interview scheduled by embassy."
                        },
                        {
                            id: "II-13",
                            name: "Receive Interview Letter",
                            who: "Beneficiary",
                            where: "Email + registered mail",
                            timeline: "2-4 weeks before interview",
                            actions: ["Receive interview appointment", "Note date and time", "Schedule medical exam IMMEDIATELY", "Gather original documents", "Make travel arrangements if needed"],
                            output: "Interview date confirmed",
                            nextTrigger: "Proceed to Stage III"
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Stage III: Medical + Interview",
                    description: "Complete medical exam ‚Üí Attend consular interview ‚Üí Visa decision",
                    timeline: "Interview within 2-4 weeks of letter",
                    steps: [
                        {
                            id: "III-01",
                            name: "Schedule Medical Examination",
                            who: "Beneficiary",
                            where: "IOM Pakistan",
                            actions: ["Contact IOM clinic", "Book appointment 1-5 days before interview", "Note documents needed", "Save confirmation"],
                            pakistanSpecific: "IOM Islamabad: +92-51-111-466-789. IOM Karachi: +92-21-111-466-789. IOM Lahore: +92-42-111-466-789",
                            fee: "$200-300 USD equivalent",
                            notes: "Medical results valid 6 months. Schedule 2-3 days before interview ideally."
                        },
                        {
                            id: "III-02",
                            name: "Obtain Fresh Police Certificate",
                            who: "Beneficiary",
                            where: "Pakistan police authorities",
                            timeline: "3-7 days (Punjab/Islamabad)",
                            actions: ["Apply at Police Khidmat Markaz or online", "Provide CNIC, passport, affidavit if needed", "Collect certificate", "Keep original for interview"],
                            notes: "Get new if previous one is 6+ months old. Need ORIGINAL for interview.",
                            pakistanSpecific: "Punjab Police Portal: pkm.punjab.gov.pk or islamabadpolice.gov.pk"
                        },
                        {
                            id: "III-03",
                            name: "Gather Original Documents",
                            who: "Beneficiary",
                            where: "Document compilation",
                            documents: ["Valid passport", "CNIC", "Interview letter", "DS-260 confirmation", "Birth certificate (original)", "Nikah Nama (original)", "Translation (original)", "Union Council certificate", "Police certificate (original)", "Sealed medical envelope", "Photos (2)", "I-864 package", "Tax transcripts", "Employment letter", "Pay stubs"],
                            actions: ["Collect all original documents", "Make 2 sets of copies", "Organize in folders", "Label clearly"],
                            notes: "Bring originals + copies. Organize petitioner and beneficiary documents separately."
                        },
                        {
                            id: "III-04",
                            name: "Attend Medical Exam",
                            who: "Beneficiary",
                            where: "IOM clinic",
                            timeline: "2-4 hours at clinic",
                            actions: ["Arrive on time with documents", "Complete intake forms", "Pay fees", "Physical examination", "Chest X-ray", "Blood tests", "Vaccination review", "Physician interview"],
                            output: "Sealed medical envelope",
                            notes: "DO NOT OPEN envelope. Results ready in 2-5 days. Collect 1-2 days before interview."
                        },
                        {
                            id: "III-05",
                            name: "Prepare for Interview",
                            who: "Beneficiary",
                            where: "Home preparation",
                            actions: ["Review DS-260 answers", "Practice common questions", "Study relationship details", "Check document checklist", "Plan outfit (professional)", "Arrange travel to Islamabad if needed"],
                            notes: "Be truthful, consistent. Know spouse details well. Dress professionally - no jeans/t-shirts."
                        },
                        {
                            id: "III-06",
                            name: "Attend Visa Interview",
                            who: "Beneficiary",
                            where: "U.S. Embassy Islamabad",
                            timeline: "5-20 minutes interview",
                            actions: ["Arrive 30+ minutes early", "Pass security (NO electronics)", "Submit documents at window", "Fingerprints taken", "Wait for consular officer call", "Take oath", "Answer questions honestly", "Receive decision"],
                            pakistanSpecific: "Address: Diplomatic Enclave, Ramna 5, Islamabad. NO mobile phones allowed.",
                            possibleOutcomes: ["Approved ‚úÖ", "Administrative Processing 221(g) ‚ö†Ô∏è", "Denied ‚ùå"],
                            notes: "Common questions: How did you meet? Tell me about your wedding. Where will you live?"
                        },
                        {
                            id: "III-07",
                            name: "Track Status (If AP)",
                            who: "Beneficiary",
                            where: "ceac.state.gov",
                            actions: ["If placed in AP, check CEAC weekly", "Check email regularly", "Respond immediately if contacted", "Be patient - no way to expedite"],
                            notes: "AP duration: 2 weeks to 12+ months (unpredictable). Common for security clearances."
                        }
                    ]
                },
                {
                    id: 4,
                    name: "Stage IV: Post-Interview & Travel",
                    description: "Receive passport with visa ‚Üí Pay USCIS fee ‚Üí Travel to U.S.",
                    timeline: "1-2 weeks for passport",
                    steps: [
                        {
                            id: "IV-01",
                            name: "Receive Passport with Visa",
                            who: "Beneficiary",
                            where: "Courier delivery (Pakistan)",
                            timeline: "1-2 weeks after approval",
                            actions: ["Track courier (TCS)", "Receive passport", "Verify visa foil information", "Check expiration date", "Make copies", "Verify: name, DOB, passport number, visa category (IR-1/CR-1)"],
                            output: "Passport with immigrant visa",
                            notes: "MUST enter U.S. before visa expiration (typically 6 months from medical exam)"
                        },
                        {
                            id: "IV-02",
                            name: "Pay USCIS Immigrant Fee",
                            who: "Either",
                            where: "uscis.gov/uscis-immigrant-fee",
                            fee: "$220",
                            actions: ["Create account at USCIS immigrant fee site", "Enter A-Number from visa", "Enter U.S. mailing address (CRITICAL)", "Pay $220 fee", "Save confirmation"],
                            output: "Green card production authorized",
                            notes: "Pay BEFORE travel recommended. Green card mailed to this address within 90 days."
                        },
                        {
                            id: "IV-03",
                            name: "Prepare for Travel",
                            who: "Beneficiary",
                            where: "Pakistan",
                            actions: ["Book flight with buffer before visa expiration", "Pack carry-on: passport, sealed envelopes, confirmations", "DO NOT open sealed envelopes", "Prepare prohibited items list", "Notify petitioner of flight details"],
                            notes: "Sealed immigration packet MUST stay sealed. Pack in carry-on, never checked luggage."
                        },
                        {
                            id: "IV-04",
                            name: "Understand Immigration Status",
                            who: "Beneficiary",
                            where: "Knowledge",
                            actions: ["Understand: become LPR upon entry", "Know IR-1 vs CR-1 difference", "Understand rights and responsibilities", "Know cannot vote until citizen"],
                            notes: "IR-1: 10-year green card. CR-1: 2-year conditional, must file I-751 to remove conditions."
                        }
                    ]
                },
                {
                    id: 5,
                    name: "Stage V: U.S. Arrival",
                    description: "Enter U.S. ‚Üí CBP inspection ‚Üí I-551 stamp ‚Üí Green card delivery",
                    timeline: "Green card within 90 days",
                    steps: [
                        {
                            id: "V-01",
                            name: "Arrival at Port of Entry",
                            who: "Beneficiary",
                            where: "U.S. airport",
                            actions: ["Follow signs to Passport Control", "Go to Foreign Nationals line", "Approach CBP officer", "Inform: first entry as immigrant", "Present passport and sealed packet", "Answer questions", "Fingerprints taken"],
                            notes: "Common questions: Purpose? Where living? How long married?"
                        },
                        {
                            id: "V-02",
                            name: "Secondary Inspection (If Needed)",
                            who: "Beneficiary",
                            where: "Secondary area",
                            timeline: "30 minutes - 2 hours",
                            actions: ["If directed, proceed to secondary", "Wait for officer", "Provide additional information", "Be patient and cooperative"],
                            notes: "Common for immigrant visa holders. Don't worry - routine."
                        },
                        {
                            id: "V-03",
                            name: "Receive I-551 Stamp",
                            who: "CBP Officer",
                            where: "Port of entry",
                            actions: ["Officer stamps passport with I-551", "Passport returned", "Sealed packet retained by CBP"],
                            output: "I-551 stamp = temporary green card (valid 1 year)",
                            notes: "This stamp proves permanent residence and work authorization until physical card arrives"
                        },
                        {
                            id: "V-04",
                            name: "Clear Customs",
                            who: "Beneficiary",
                            where: "Airport customs",
                            actions: ["Collect baggage", "Fill customs form", "Declare items over $800 or restricted items", "Present to customs officer", "Exit airport"],
                            notes: "Declare any food, plants, amounts over $10,000 cash"
                        },
                        {
                            id: "V-05",
                            name: "Post-Arrival Actions",
                            who: "Beneficiary",
                            where: "U.S. residence",
                            timeline: "First week",
                            actions: ["Arrive at U.S. residence", "Wait for Social Security card (2-4 weeks)", "If doesn't arrive, apply at SSA office", "Verify green card mailing address", "Register for Selective Service if male 18-25"],
                            notes: "SSN auto-issued if checked Yes on DS-260. Green card arrives within 90 days of entry or payment."
                        },
                        {
                            id: "V-06",
                            name: "Receive Green Card",
                            who: "Beneficiary",
                            where: "U.S. mailing address",
                            timeline: "30-90 days",
                            actions: ["Track via USCIS immigrant fee account", "Receive green card via USPS", "Verify all information correct", "Sign back of card immediately"],
                            output: "Physical green card (I-551)",
                            notes: "If error on card, file I-90 immediately. IR-1: valid 10 years. CR-1: valid 2 years."
                        },
                        {
                            id: "V-07",
                            name: "Maintain Green Card",
                            who: "Beneficiary (LPR)",
                            where: "United States",
                            actions: ["Carry green card at all times", "File U.S. taxes annually", "Update address with USCIS within 10 days (AR-11)", "Don't leave U.S. for 6+ months without planning", "For CR-1: File I-751 within 90 days of 2-year anniversary"],
                            notes: "CR-1 CRITICAL: Must file I-751 jointly with spouse to remove conditions. Failure = loss of status."
                        },
                        {
                            id: "V-08",
                            name: "Path to Citizenship (Future)",
                            who: "LPR",
                            where: "Future planning",
                            timeline: "3 years (if still married to USC)",
                            actions: ["After 3 years as LPR, can apply for citizenship via N-400", "Requirements: physical presence, good moral character, English, civics test"],
                            notes: "Optional - can remain LPR indefinitely. Citizenship allows voting, more job options, cannot be deported."
                        }
                    ]
                }
            ],
            documents: [
                "U.S. Passport or Birth Certificate (Petitioner)",
                "Pakistani Passport (Beneficiary)",
                "NADRA Birth Certificate (Beneficiary)",
                "Nikah Nama (Original)",
                "English Translation of Nikah Nama (Certified)",
                "Union Council Marriage Registration",
                "Police Certificate - Pakistan (Original)",
                "Passport Photos (2x2 inches, white background)",
                "Tax Returns (IRS Transcripts - 3 years)",
                "Employment Verification Letter",
                "Pay Stubs (6 months)",
                "W-2 Forms",
                "Bank Statements",
                "I-864 Affidavit of Support (Signed)",
                "Marriage Photos (throughout relationship)",
                "Communication Records (WhatsApp, email samples)",
                "Visit Evidence (flight tickets, stamps)",
                "Divorce Decrees (if applicable)",
                "Death Certificates (if widowed)"
            ]
        };

        let state = {
            currentStage: 0,
            currentStep: null,
            completedSteps: new Set(),
            collapsedSteps: {},
            role: 'both',
            filingType: 'online',
            documentChecklist: {},
            docUploads: {},
            notes: {},
            started: false
        };

        function getTotalSteps() {
            return roadmapData.stages.reduce((sum, s) => sum + s.steps.length, 0);
        }

        function getStage(idx = state.currentStage) {
            return roadmapData.stages[idx];
        }

        function normalizeState() {
            if (typeof state.currentStage !== 'number' || state.currentStage < 0) state.currentStage = 0;
            if (state.currentStage >= roadmapData.stages.length) state.currentStage = roadmapData.stages.length - 1;

            const st = getStage();
            if (!st) return;

            if (state.currentStep === null || typeof state.currentStep !== 'number' || state.currentStep < 0 || state.currentStep >= st.steps.length) {
                const incomplete = st.steps.findIndex(s => !state.completedSteps.has(s.id));
                state.currentStep = incomplete === -1 ? 0 : incomplete;
            }

            const curStep = st.steps[state.currentStep];
            if (curStep) {
                state.collapsedSteps[curStep.id] = false;
            }
        }

        function init() {
            loadState();
            normalizeState();
            renderStageNav();
            renderStage();
        }

        function renderStageNav() {
            const nav = document.getElementById('stage-nav');
            if (!nav) return;
            nav.innerHTML = roadmapData.stages.map((stage, idx) => {
                const completed = stage.steps.filter(s => state.completedSteps.has(s.id)).length;
                const total = stage.steps.length;
                return `
                    <li class="stage-item">
                        <button class="stage-btn ${state.currentStage === idx ? 'active' : ''}" onclick="switchStage(${idx})">
                            <div>
                                <div style="font-weight: 600; font-size: 13px;">${stage.name.split(':')[0]}</div>
                                <div style="font-size: 11px; opacity: 0.8;">${completed}/${total}</div>
                            </div>
                        </button>
                    </li>
                `;
            }).join('');
            updateProgress();
        }

        function switchStage(stageIdx) {
            state.currentStage = stageIdx;
            state.currentStep = null;
            normalizeState();
            renderStage();
            saveState();
        }

        function renderStage() {
            const stage = getStage();
            if (!stage) return;

            const titleEl = document.getElementById('stage-title');
            const descEl = document.getElementById('stage-description');
            if (titleEl) titleEl.textContent = stage.name;
            if (descEl) descEl.textContent = `${stage.description} ‚Ä¢ ${stage.timeline}`;

            renderProgressTree();
            renderStepCards();
            renderStageNav();
            updateProgress();
            updateDashboardProgress();
            saveState();
        }

        function renderProgressTree() {
            const stage = getStage();
            const tree = document.getElementById('progress-tree');
            if (!tree || !stage) return;

            tree.innerHTML = stage.steps.map((step, idx) => {
                const completed = state.completedSteps.has(step.id);
                const current = idx === state.currentStep;
                const dimmed = shouldDimStep(step);
                const dotText = completed ? '‚úì' : (current ? '‚Ä¢' : '');

                return `
                    <button class="tree-item ${completed ? 'completed' : ''} ${current ? 'current' : ''} ${dimmed ? 'dimmed' : ''}"
                            data-step-id="${step.id}"
                            onclick="activateStep(${idx}, true)">
                        <div class="tree-dot">${dotText}</div>
                        <div class="tree-label">
                            <div class="tree-stepid">${step.id}</div>
                            <div class="tree-stepname">${step.name}</div>
                        </div>
                    </button>
                `;
            }).join('');
        }

        function renderStepCards() {
            const stage = getStage();
            const container = document.getElementById('steps-container');
            if (!container || !stage) return;

            container.innerHTML = stage.steps.map((step, idx) => {
                const isCompleted = state.completedSteps.has(step.id);
                const isDimmed = shouldDimStep(step);
                const isCurrent = idx === state.currentStep;
                const defaultCollapsed = isCompleted && !isCurrent;
                const collapsed = (state.collapsedSteps[step.id] ?? defaultCollapsed) && !isCurrent;

                // Add tool buttons for specific steps
                let toolButtons = '';
                if (step.id === 'I-02' || step.id === 'III-02') {
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('Police Certificate Letter Generator (Premium)')">üìù Generate Request Letter</button>`;
                }
                if (step.id === 'II-05') {
                    toolButtons += `<div class="video-placeholder" style="margin-top: 16px; padding: 20px;"><h4 style="font-size: 14px;">üìπ Video: Preparing NVC/CEAC Documents (6 min)</h4><ul style="font-size: 12px;"><li>Scanning tips, compression, naming, common rejections</li></ul><button class="video-play-btn" disabled style="padding: 8px 16px; font-size: 12px; margin-top: 8px;">‚ñ∂ Play Video</button></div>`;
                }
                if (step.id === 'II-06' || step.id === 'II-08') {
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('Document Naming Helper (Free)')">üìÑ Name Files Correctly</button>`;
                }
                if (step.id === 'II-07') {
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('I-864 Calculator (Free)')">üí∞ Calculate Income Requirements</button>`;
                }
                if (step.id === 'III-01') {
                    toolButtons += `<div class="video-placeholder" style="margin-top: 16px; padding: 20px;"><h4 style="font-size: 14px;">üìπ Video: Pakistani Police Certificate Process (4 min)</h4><ul style="font-size: 12px;"><li>PKM portal walkthrough, timelines, common issues</li></ul><button class="video-play-btn" disabled style="padding: 8px 16px; font-size: 12px; margin-top: 8px;">‚ñ∂ Play Video</button></div>`;
                }
                if (step.id === 'III-05') {
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('Interview Prep Bank (Premium)')">üéØ Practice Interview Questions</button>`;
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('Embassy Prep Checklist (Free)')">üìã What to Bring</button>`;
                }
                if (step.id === 'III-06') {
                    toolButtons += `<div class="video-placeholder" style="margin-top: 16px; padding: 20px;"><h4 style="font-size: 14px;">üìπ Video: Islamabad Embassy Interview (5 min)</h4><ul style="font-size: 12px;"><li>Security, typical questions, what happens after</li></ul><button class="video-play-btn" disabled style="padding: 8px 16px; font-size: 12px; margin-top: 8px;">‚ñ∂ Play Video</button></div>`;
                }
                if (step.id === 'V-05') {
                    toolButtons += `<button class="tool-button" onclick="event.stopPropagation(); alert('Post-Arrival 90-Day Checklist (Free)')">üìã View Checklist</button>`;
                    toolButtons += `<div class="video-placeholder" style="margin-top: 16px; padding: 20px;"><h4 style="font-size: 14px;">üìπ Video: Your First 90 Days in America (7 min)</h4><ul style="font-size: 12px;"><li>SSN, banking, green card, I-751 reminder, travel</li></ul><button class="video-play-btn" disabled style="padding: 8px 16px; font-size: 12px; margin-top: 8px;">‚ñ∂ Play Video</button></div>`;
                }

                return `
                    <div class="step-card ${isCompleted ? 'completed' : 'pending'} ${isCurrent ? 'current' : ''} ${isDimmed ? 'dimmed' : ''} ${collapsed ? 'collapsed' : ''}"
                         data-step-id="${step.id}"
                         data-step-idx="${idx}"
                         onclick="activateStep(${idx}, false)">
                        <div class="step-header">
                            <div class="step-title">
                                <div class="step-id">${step.id}</div>
                                <div class="step-name">${step.name}</div>
                                <div class="step-meta">
                                    ${step.who ? `<span class="badge badge-blue">üë§ ${step.who}</span>` : ''}
                                    ${step.where ? `<span class="badge" style="background: #e9d5ff; color: #7c3aed;">üìç ${step.where}</span>` : ''}
                                    ${step.timeline ? `<span class="badge badge-premium">‚è±Ô∏è ${step.timeline}</span>` : ''}
                                    ${step.fee ? `<span class="badge badge-free" style="background: #d1fae5; color: #065f46;">üí∞ ${step.fee}</span>` : ''}
                                </div>
                                ${collapsed ? `<div class="collapse-pill">Collapsed ‚Äî click to expand</div>` : ''}
                            </div>
                            <div class="step-actions">
                                <button class="btn ${isCompleted ? 'btn-secondary' : 'btn-primary'}"
                                        onclick="toggleComplete('${step.id}', event)">
                                    ${isCompleted ? '‚úì Completed' : 'Mark Complete'}
                                </button>
                            </div>
                        </div>

                        <div class="step-content">
                            ${step.actions ? `
                                <div class="content-section">
                                    <h4>Actions Required:</h4>
                                    <ul>${step.actions.map(a => `<li>${a}</li>`).join('')}</ul>
                                </div>
                            ` : ''}

                            ${step.inputs ? `
                                <div class="content-section">
                                    <h4>Inputs Needed:</h4>
                                    <ul>${step.inputs.map(i => `<li>${i}</li>`).join('')}</ul>
                                </div>
                            ` : ''}

                            ${step.documents ? `
                                <div class="content-section">
                                    <h4>Documents Required:</h4>
                                    <ul>${step.documents.map(d => `<li>${d}</li>`).join('')}</ul>
                                </div>
                            ` : ''}

                            ${step.output ? `
                                <div class="content-section">
                                    <h4>Success Condition:</h4>
                                    <p>${step.output}</p>
                                </div>
                            ` : ''}

                            ${step.nextTrigger ? `
                                <div class="content-section">
                                    <h4>Next Step Trigger:</h4>
                                    <p>${step.nextTrigger}</p>
                                </div>
                            ` : ''}

                            ${step.possibleOutcomes ? `
                                <div class="content-section">
                                    <h4>Possible Outcomes:</h4>
                                    <ul>${step.possibleOutcomes.map(o => `<li>${o}</li>`).join('')}</ul>
                                </div>
                            ` : ''}

                            ${step.notes ? `
                                <div class="alert alert-info">
                                    <span>‚ÑπÔ∏è</span>
                                    <div>${step.notes}</div>
                                </div>
                            ` : ''}

                            ${step.pakistanSpecific ? `
                                <div class="alert alert-warning">
                                    <span>üáµüá∞</span>
                                    <div><strong>Pakistan-Specific:</strong> ${step.pakistanSpecific}</div>
                                </div>
                            ` : ''}

                            ${step.officialSource ? `
                                <div class="alert alert-warning">
                                    <span>‚ö†Ô∏è</span>
                                    <div><strong>Verify:</strong> ${step.officialSource}</div>
                                </div>
                            ` : ''}

                            ${toolButtons}
                        </div>
                    </div>
                `;
            }).join('');

            filterSteps();
        }

        function activateStep(idx, scroll) {
            if (idx === state.currentStep) return;
            state.currentStep = idx;
            const stage = getStage();
            const step = stage.steps[idx];
            if (step) state.collapsedSteps[step.id] = false;
            renderProgressTree();
            updateStepClasses();
            saveState();

            if (scroll) {
                const card = document.querySelector(`.step-card[data-step-idx="${idx}"]`);
                if (card) card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function updateStepClasses() {
            const stage = getStage();
            const currentStepObj = stage.steps[state.currentStep];

            document.querySelectorAll('.step-card').forEach(card => {
                const stepId = card.dataset.stepId;
                const idx = Number(card.dataset.stepIdx);
                const step = stage.steps[idx];
                const completed = state.completedSteps.has(stepId);
                const current = currentStepObj && stepId === currentStepObj.id;
                const dimmed = shouldDimStep(step);
                const defaultCollapsed = completed && !current;
                const collapsed = (state.collapsedSteps[stepId] ?? defaultCollapsed) && !current;

                card.classList.toggle('completed', completed);
                card.classList.toggle('pending', !completed);
                card.classList.toggle('current', current);
                card.classList.toggle('dimmed', dimmed);
                card.classList.toggle('collapsed', collapsed);

                const btn = card.querySelector('.step-actions .btn');
                if (btn) {
                    btn.classList.toggle('btn-primary', !completed);
                    btn.classList.toggle('btn-secondary', completed);
                    btn.textContent = completed ? '‚úì Completed' : 'Mark Complete';
                }
            });

            renderProgressTree();
        }

        function toggleComplete(stepId, ev) {
            if (ev) ev.stopPropagation();
            const y = window.scrollY;

            const wasCompleted = state.completedSteps.has(stepId);
            if (wasCompleted) {
                state.completedSteps.delete(stepId);
                state.collapsedSteps[stepId] = false;
            } else {
                state.completedSteps.add(stepId);
                state.collapsedSteps[stepId] = true;
            }

            const stage = getStage();
            const currentId = stage.steps[state.currentStep]?.id;
            if (!wasCompleted && currentId === stepId) {
                const nextIdx = stage.steps.findIndex(s => !state.completedSteps.has(s.id));
                if (nextIdx !== -1) state.currentStep = nextIdx;
            }

            normalizeState();
            updateProgress();
            renderStageNav();
            updateStepClasses();
            updateDashboardProgress();
            saveState();

            window.scrollTo({ top: y });
        }

        function shouldDimStep(step) {
            if (state.role === 'both') return false;
            const who = step.who?.toLowerCase() || '';
            if (!who || who === 'both') return false;
            if (state.role === 'petitioner' && who === 'beneficiary') return true;
            if (state.role === 'beneficiary' && who === 'petitioner') return true;
            return false;
        }

        function setRole(role) {
            state.role = role;
            document.querySelectorAll('[data-role]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.role === role);
            });
            saveState();
            renderStepCards();
        }

        function setFiling(filing) {
            state.filingType = filing;
            document.querySelectorAll('[data-filing]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filing === filing);
            });
            saveState();
            renderStepCards();
        }

        function filterSteps() {
            const searchEl = document.getElementById('search');
            if (!searchEl) return;
            const search = searchEl.value.toLowerCase();

            document.querySelectorAll('.step-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                const matches = !search || text.includes(search);
                card.style.display = matches ? 'block' : 'none';
            });

            document.querySelectorAll('.tree-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                const matches = !search || text.includes(search);
                item.style.display = matches ? 'flex' : 'none';
            });
        }

        function updateProgress() {
            const totalSteps = getTotalSteps();
            const completed = state.completedSteps.size;
            const percent = totalSteps === 0 ? 0 : Math.round((completed / totalSteps) * 100);

            const progressEl = document.getElementById('overall-progress');
            const barEl = document.getElementById('overall-progress-bar');
            if (progressEl) progressEl.textContent = `${completed}/${totalSteps}`;
            if (barEl) barEl.style.width = `${percent}%`;
        }

        function renderDocumentVault() {
            const content = document.getElementById('checklist-content');
            if (!content) return;

            const disclaimer = `
                <div class="alert alert-info" style="margin-bottom: 16px;">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        <strong>Note:</strong> Files are saved as metadata only (name, size) for privacy. 
                        You may need to re-select after browser refresh.
                    </div>
                </div>
            `;

            content.innerHTML = disclaimer + roadmapData.documents.map((doc) => {
                const checked = state.documentChecklist[doc] || false;
                const note = state.notes[doc] || '';
                const upload = state.docUploads[doc] || null;
                const uploadLabel = upload?.name ? `‚úì ${upload.name}` : 'No file';

                return `
                    <div class="doc-row">
                        <div class="doc-name">${doc}</div>
                        <div style="font-size: 12px; color: var(--text-light); margin-bottom: 8px;">${uploadLabel}</div>
                        <div class="doc-actions">
                            <label style="display: flex; align-items: center; gap: 6px; font-size: 13px;">
                                <input type="checkbox" ${checked ? 'checked' : ''} onchange="toggleDocument('${doc}')">
                                Collected
                            </label>
                            <input type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="handleDocUpload('${doc}', this.files[0])" style="font-size: 12px; max-width: 200px;">
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="clearDocUpload('${doc}')">Clear</button>
                        </div>
                        <input type="text" class="notes-input" placeholder="Notes..." value="${escapeHtml(note)}"
                               onchange="updateNote('${doc}', this.value)">
                    </div>
                `;
            }).join('');
        }

        function escapeHtml(str) {
            return String(str || '')
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#039;');
        }

        function handleDocUpload(doc, file) {
            if (!file) return;
            state.docUploads[doc] = {
                name: file.name,
                size: file.size,
                lastModified: file.lastModified
            };
            saveState();
            renderDocumentVault();
        }

        function clearDocUpload(doc) {
            delete state.docUploads[doc];
            saveState();
            renderDocumentVault();
        }

        function toggleDocument(doc) {
            state.documentChecklist[doc] = !state.documentChecklist[doc];
            saveState();
        }

        function updateNote(doc, value) {
            state.notes[doc] = value;
            saveState();
        }

        function openModal(type) {
            if (type === 'checklist') renderDocumentVault();
            const modal = document.getElementById(`${type}-modal`);
            if (modal) modal.classList.add('active');
        }

        function closeModal(type) {
            const modal = document.getElementById(`${type}-modal`);
            if (modal) modal.classList.remove('active');
        }

        function exportProgress() {
            const data = {
                ...state,
                completedSteps: Array.from(state.completedSteps)
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rahvana-ir1-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importProgress() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        state = {
                            ...data,
                            completedSteps: new Set(data.completedSteps || []),
                            collapsedSteps: data.collapsedSteps || {},
                            documentChecklist: data.documentChecklist || {},
                            docUploads: data.docUploads || {},
                            notes: data.notes || {},
                            started: !!data.started
                        };
                        saveState();
                        renderStage();
                        alert('Progress imported successfully!');
                    } catch (err) {
                        alert('Error importing file');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetData() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                localStorage.removeItem('rahvanaWizardState');
                state = {
                    currentStage: 0,
                    currentStep: null,
                    completedSteps: new Set(),
                    collapsedSteps: {},
                    role: 'both',
                    filingType: 'online',
                    documentChecklist: {},
                    docUploads: {},
                    notes: {},
                    started: false
                };
                renderStage();
                updateDashboardProgress();
            }
        }

        function saveState() {
            const data = {
                ...state,
                completedSteps: Array.from(state.completedSteps)
            };
            localStorage.setItem('rahvanaWizardState', JSON.stringify(data));
        }

        function loadState() {
            const saved = localStorage.getItem('rahvanaWizardState');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    state = {
                        ...state,
                        ...data,
                        completedSteps: new Set(data.completedSteps || [])
                    };
                } catch (e) {
                    console.error('Error loading state:', e);
                }
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>